<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie9" lang="en"> <![endif]-->
<!--[if gt IE 9]><!--> <html class="no-js" lang="en" ng-app="buildlogApp"> <!--<![endif]-->
<head>
    
    <title>Project logs &bull; Sonar for the visually impaired &bull; Hackaday.io</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="//cdn.hackaday.io/css/style.css?version=0.48.6" />
    <script type="text/javascript" src="//use.typekit.net/ymb0lgk.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>
<body class="logs">

    <!--
############################################################################################
############################################################################################
############################################################################################
#####################Kt;tL#######################################Kti,E######################
#######################;   .###################################G    E#######################
#######################K    f##################################    ;########################
########################Wj   E###############################K:  .W#########################
##########################.  :E##############################:  .L##########################
#########################D    f##############################.   .##########################
########################,     ;##############################     :E#######K################
################f######K      ,##############################      ,######Lt################
################  W###W       i##############################       t####j t################
################:  E#L.        f###########################L.        f#Ki .E################
################j  ;E.          j##########################.         .G;  i#################
#################L               i#######################K                ##################
#################W                E#####################K;               ;##################
###################:               .###################D               :f###################
#####################DLfGD           G####WEEEEKW####W           ;GffGK#####################
##########################i         iD##Kfi    :jKW##D          iE##########################
###########################W      ,G##f            jE#E;       j############################
############################L     D##D              ,##K       W############################
#############################D:  G#W                  K#E,   G##############################
###############################;i#L                    j## ,E###############################
###############################KK#.                     ##iE################################
#################################j                      ;K##################################
################################W                        ,##################################
################################E                         ##################################
###############################Ki                         D#################################
###############################E.                         L#################################
###############################f    iD##W;       D###D    :#################################
###############################i   i######K     K#####K;   #################################
###############################;  .E#######     #######D   #################################
###############################;  L########     ########   #################################
###############################i  G#######K     K#######   #################################
###############################j  L#####E,       fE#####   #################################
###############################D  .E##j            .t##E  ;#################################
###############################E:  ;##.              #Wt  j#################################
################################G   ;t      tWi      t    E#################################
#############################KL##           K#K;          #K:K##############################
#############################i ##:          ###t         j#f ;K#############################
############################:  G#K          #E#L        L##    D############################
###########################D   ;W#:         #;#L        W#K    .############################
#####################KKEKK      :##L        ; ..      :D##.      fKEEK######################
###################t.            ;##G:               ,##E,             tD###################
##################G               E##E               i##;               :###################
#################D                W##W    iL    E.    ###D                ##################
################W,               G###W    tG    K.    ####:               K#################
################;  LW;         ,E#####:  ;W#    #G   f#####;         ;KG  :K################
################  D###E       ;########WW####WW####WW#######W       :####: j################
################ ,#####:      ;##############################       G####E i################
################K#######.     ;##############################      L######WG################
########################f     i##############################     j#########################
#########################W   .D##############################.   i##########################
#########################E   G###############################D   ,##########################
########################G:   #################################j   G#########################
#######################f    K##################################j    W#######################
#####################Kt :iE#####################################KL:  K######################
############################################################################################
############################################################################################
############################################################################################
-->

<div class="header" id="header">
    <div class="container">
        <h1 class="logo">
            <a href="/" title="Hackaday.io Home" class="home" onclick="CT(this, 'Menu', 'Home'); return false;"></a>
            <a href="/" title="Hackaday.io Home" class="brand" onclick="CT(this, 'Menu', 'Home'); return false;">Hack a Day</a>
        </h1>

        <a href="javascript:void(0);" class="responsive-menu">Menu</a>

        <ul class="nav" role="navigation">
            <li><a href="/projects" class="">Projects</a></li>
            <li><a href="/lists" class="">Lists</a></li>
            <li><a href="/stack" class="">Stack</a></li>
            <li class="dropdown more-nav j-more-open">
                <a href="javascript:void(0)" class="dropdown-link icon-dropdown">More</a>
                <ul role="menu" class="dropdown-menu more-menu" id="j-more">
                    <li><a href="http://hackaday.com/blog/" target="_blank">Blog</a></li>
                    <li><a href="/events">Events</a></li>
                    <li><a href="/hackerspaces">Hackerspaces</a></li>
                    <li><a href="/hackers">Profiles</a></li>
                    <li><a href="/contests">Contests</a></li>
                    <li><a href="/prize" target="_blank">The Hackaday Prize</a></li>
                    <li><a href="/submissions/prize2015/list">2015 Prize Entries</a></li>
                </ul>
            </li>
            <li class="menu-last-child">
                <div class="search-holder show">
                    <form id="search-form" action="/search" onsubmit="return submitSearch();" method="GET">
                        <input type="text" placeholder="Search" name="term" class="input-search j-add-search" id="j-add-search" value="" autocomplete="off" pattern=".{3,}" required title="3 characters minimum" />
                        <input type="submit" class="search-button" />
                    </form>
                </div>
            </li>
        </ul>

        

            <ul class="nav pull-right" role="navigation">
                <li><a href="/signup" class="grey-white-button become-member">Sign up</a></li>
                <li><a href="/signin?returnUrl=%2Fproject%2F5903%2Flogs">Sign in</a></li>
            </ul>

        
    </div>
</div>

<div id="topMessage" class="alert"><span class="j-top-content"></span><a href="javascript:void(0);" class="alert-close j-top-message-close">Close</a></div>




    <div class="headline">
        <div class="container">
            <h2><a href="/project/5903-sonar-for-the-visually-impaired">Sonar for the visually impaired</a></h2>
            <p class="description-title"> Project logs</p>
            <p class="description-summary">This is a low cost portable Ultrasonic range finder and sonar device to help a visually impaired person navigate indoors.</p>
            <div class="description-metainfo">
                
                    <span>created by <a href="/hacker/10708-kc-lee" title="Visit Profile">K.C. Lee</a><span>&bull;</span>
                
                3 months ago<span>&bull;</span><a href="/project/5903#discussion-list" title="See Comments">4 Comments</a></span>
            </div>
        </div>
    </div>

    <div class="container post-content">
        <div class="section-buildsort">
            <span class="pull-left">
                <a href="/project/5903-sonar-for-the-visually-impaired">&#171; Back to project details</a>
            </span>
            <span class="sort-holder pull-right">
                <label for="sort-by">Sort by:</label>
                <select class="sort" id="sort-by">
                    <option value="/project/5903/logs/sort/newest">Newest</option>
                    <option value="/project/5903/logs/sort/oldest" selected="selected">Oldest</option>
                </select>
            </span>
        </div>
        <div class="section section-buildlogs last">
            

                <ul class="buillogs-list">
                    
                        <li>
                            <h2><a href="/project/5903/log/18255-some-light-readings-reference-material">Some light readings - Reference material</a></h2>
                            <small class="authorship">3 months ago  &bull;
                                <a class="gray-link" href="/project/5903/log/18255#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-18255"><p><img src="https://cdn.hackaday.io/images/7668801432175277117.jpg" width="328" height="151" alt="" style="width: 328px; height: 151px; float: left; margin: 0px 10px 10px 0px;"></p><p>Here are the couple of really old ultrasonic transducers that I bought a long time ago. The one on the left is MA40A3R (receiver) and the one on the right has a T30 marking. (transmitter)</p><p><span></span><a href="http://ww1.microchip.com/downloads/en/AppNotes/00001536A.pdf">Microchip AN1536 Ultrasonic Range Detection</a> There are quite a bit of technical back information on interfacing the sensor.</p><p>The equivalent circuit would comes in handy when it comes time to simulate the driver circuit.The ringing time limits the minimum distance that the range finder can be used. It is not an issue for this application as the distance is going be less than what I am going to be used as the proximity alert.</p><p><img src="https://cdn.hackaday.io/images/6577441432161320963.gif" alt="" style="float: left; margin: 0px 10px 10px 0px;"></p><p><img src="https://cdn.hackaday.io/images/6891181432161180188.gif" alt="" style="display: block; margin: auto;"></p><p><a href="http://www.prowave.com.tw/english/item/qa.htm">Prowave App Notes:</a><br></p><p><a href="http://www.prowave.com.tw/pdf/an0508309.pdf">Prowave AP050830:  Selection and use of Ultrasonic Ceramic Transducers</a><br></p><p>The nice thing about my placement is that my head will be blocking the beam going to the other sensor.  Still I am going to alternate the range finder to avoid interference and reduce current consumption.</p><p><img src="https://cdn.hackaday.io/images/4121121432177329299.png" width="270" height="280" alt="" style="width: 270px; height: 280px; float: left; margin: 0px 10px 10px 0px;"></p><p>Found this <a href="http://entesla.com/ultrasonic-sensor">here</a></p><p><img src="https://cdn.hackaday.io/images/2386681432334757482.png"></p><p>For a +/- 15 degrees beam, the coverage would be like this.  I am no expert, but this looks reasonable.</p><p><img src="https://cdn.hackaday.io/images/6434451432336154252.png"></p><hr><p>Similar HaD project: <a href="https://hackaday.io/project/2372-pathfinder-haptic-navigation">https://hackaday.io/project/2372-pathfinder-haptic-navigation</a> <br>This one is quite a bit farther and the results are encouraging too.  Looks like that Chinese ultrasonic range finder PCB works better than I thought.</p><p>I am going to order a few and try to see if I can improve on the design in fine tuning for size, weight and power consumption.  Ideally I would like to use the same transducer for transmit and receive.</p><p>Other websites:</p><p><a href="http://www.kerrywong.com/2011/01/22/a-sensitive-diy-ultrasonic-range-sensor/">http://www.kerrywong.com/2011/01/22/a-sensitive-diy-ultrasonic-range-sensor/</a></p><hr><p>Random thought: (not a product feature as it drains the battery quickly)<br><a href="http://mcuoneclipse.com/2014/11/30/tutorial-web-server-with-the-esp8266-wifi-module/">http://mcuoneclipse.com/2014/11/30/tutorial-web-server-with-the-esp8266-wifi-module/</a></p><p>This could be useful for telemetry for untethered testing. </p><hr><p>The 3D printed glasses frame is a good starting point for the mechanical design.<br><a href="http://www.thingiverse.com/search/page:5?q=glasses&amp;sa=" target="_blank">http://www.thingiverse.com/search/page:5?q=glasses&amp;sa=</a></p><p>The 3D scanned Head model is from here:<br><a href="http://www.3dcontentcentral.net/3DContentCentral/download-model.aspx?catalogid=171&amp;id=207550">http://www.3dcontentcentral.net/3DContentCentral/download-model.aspx?catalogid=171&amp;id=207550</a></p><hr><p>Haptic motor app notes:<br><a href="http://www.precisionmicrodrives.com/application-notes-technical-guides">http://www.precisionmicrodrives.com/application-notes-technical-guides</a></p><p><img src="https://cdn.hackaday.io/images/2952461433510880970.jpg" width="374" height="224" style="width: 374px; height: 224px;"></p><p>That means that the motors should be parallel to the glasses frame.</p><hr><p><img src="https://cdn.hackaday.io/images/828231433646706954.png"></p><p><a href="http://data.energizer.com/PDFs/E91.pdf">AA battery discharge curve from Energizer datasheet</a>.</p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/5903/log/18281-mems-is-the-word">MEMS is the word</a></h2>
                            <small class="authorship">3 months ago  &bull;
                                <a class="gray-link" href="/project/5903/log/18281#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-18281"><p>This is the area that I need a bit of bottom-up engineering to see what is available.</p><p><img src="https://cdn.hackaday.io/images/6201991432206224846.gif"></p><p>The block diagram of <a href="http://www.freescale.com/webapp/sps/site/prod_summary.jsp?code=FXOS8700CQ">FXOS8700</a> (below). While I wasn't specifically looking for magnetic sensors, they might come in handy as it can provide compass bearing.  The datasheet claims that 0.1 µT/LSB, with a 0.3uT-1.5µT of noise depending on sampling time. The part can work with 3.3V VDD/VIO and comes in 0.5mm QFN part.</p><p><img src="https://cdn.hackaday.io/images/6387531432206712945.gif"></p><p>The 3-axis offers some flexibilities on what orientation the sensor is mounted.  Based on the sensor data, the head orientation and motion could be determined.</p><p><img src="https://cdn.hackaday.io/images/2984601432207143323.gif"></p><p> A few "throwies" of rare earth magnets could be used to mark way points or points of interest, but they have to be used sparingly as there can be only so much user feedback.  I'll need to work out the math or experiment later on to figure out the effective distances.  $2 for 100 magnets, I am in!</p><p>I did some reading about magnets. The closer their poles are, the less likely to detect them from a distance. One option is to stack multiple magnets together. This would help me find out what would kind of ratio would work by trial &amp; error.<br></p><p><img src="https://cdn.hackaday.io/images/9988391432207964004.gif"></p><hr><p><a href="http://www.freescale.com/">Freescale</a> has a few app notes for their sensors:</p><ul><li><a href="http://cache.freescale.com/files/sensors/doc/app_note/AN4246.pdf">AN4246</a> "Calibrating an eCompass in the Presence of Hard and Soft-Iron Interference"</li><li><a href="http://cache.freescale.com/files/sensors/doc/app_note/AN4247.pdf">AN4247</a> "Layout Recommendation for PCBs Using a magnetometer Sensor"</li><li><a href="http://cache.freescale.com/files/sensors/doc/app_note/AN4248.pdf">AN4248</a> "Implementing a Tilt-Compensated eCompass using Accelerometer and Magnetometer Sensors"</li><li> <a href="http://cache.freescale.com/files/sensors/doc/app_note/AN4249.pdf">AN4249</a> "Accuracy of Angle Estimation in eCompass and 3-D Pointer Applications"</li><li><span class="l"><span class="goog-trans-section l"><a href="http://cache.freescale.com/files/sensors/doc/app_note/AN4459.pdf">AN4459</a> "Using the Xtrinsic FXOS8700CQ Auto-Calibration Function"  + <a href="http://cache.freescale.com/files/sensors/doc/app_note/AN4459SW.zip">Software</a></span></span></li></ul><p style="margin-left: 40px;"><em>"On target platforms with limited processing power (wrist watches for example) it may not be possible to run a compensation engine for an eCompass as depicted in Freescale application notes AN4246 and AN4248. For such platforms, FXOS8700CQ provides an auto-calibration function that calculates the hard-iron estimate (calibration) and automatically subtracts it (compensation) from the current magnetic-field readings. This way FXOS8700CQ provides magnetic X/Y/Z data with hard-iron </em><em>compensation already applied to it."</em>     </p><p style="margin-left: 40px;"><strong>Nice!!!  </strong>Less chances of me getting the wrong math.  This looks like it is a good part to use.</p><p>There is also <a href="https://freescale.jiveon.com/docs/DOC-103424">Freescale Sensors Breakout Boards Designs – HOME</a> if you just want to grab a breakout board design and order PCB from OSH.  They also have Eagle CAD library.  There are differences between the recommended foot from datasheet and their Eagle library.  As always, Trust but Verify!  I have learnt that painful lessons too many times already.</p><p>Layout:</p><p style="margin-left: 20px;"><em>Make the magnetometer placement the first step when outlining a new PCB layout. The ideal location for the magnetometer is to be as far away as possible from all sources of hard and soft interference and from high current traces. The best locations are often to be found on an edge or at </em><em>a corner of the PCB.</em></p><p style="margin-left: 20px;"><em>Other electromagnetic components found on smartphones are loudspeakers, vibrators, hearing aid </em><em>coils, batteries and near field communication (NFC) antennas. These will create permanent hard </em><em>iron, induced soft iron and current-sourced magnetic fields and should also be placed as far as </em><em>possible from the magnetometer.</em></p><p>I'll need to place the sensor towards the front away from the speakers/vibrating motors and on the opposite side of the power supply.  Probably should look into Nylon screws/mounting hardware around that area.</p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/5903/log/18285-power-matters">Power Matters</a></h2>
                            <small class="authorship">3 months ago  &bull;
                                <a class="gray-link" href="/project/5903/log/18285#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-18285"><p>When it comes to power density and weight, it is hard to beat the Li battery chemistry.  I want something small but easy to be replaced, so looks like Li-ion in CR123A (16340) <a href="http://en.wikipedia.org/wiki/List_of_battery_sizes#Camera_batteries">form factor</a> might be suited for my application.  Wiki page say typical battery capacity is 500-1000mAHr for rechargeable ones. </p><p> There are also non-rechargeable version at 3V around 1500mAH ( e.g. <a href="http://www.duracell.com/en-us/products/camera-batteries/duracell-ultra-123-lithium-battery">Duracell</a>, <a href="http://www.energizer.com/batteries/specialty-batteries/lithium-photo-batteries">Energizer</a> (<a href="http://data.energizer.com/PDFs/123.pdf">datasheet</a>), <a href="http://www.rayovac.com/portable-power/portable-power-bundles/lithium-123a-bundle.aspx">Rayovac</a>.  Those are expensive, but offers decent capacities for emergency replacement.  Might also be worth while to have a connector for those RC heilcoptors for emergency replacement?</p><p>Digikey don&apos;t sell Li-ion batteries probably because of transportation safety issues.  At the usual Chinese mail order place, I can get these batteries at around $2 a piece.  For prototyping purposes, I guess they have to do.</p><ul><ul><li><em>Product name:3.7v CR123A/16340 Reachargeable Battery</em></li><li><em>Capacity: 1000mAh</em></li><li><em>Voltage: 3.7V</em></li><li><em>Chemistry: Li-ion</em></li><li><em>Weight : 16g&#xB1; 1g (1pc) </em></li></ul></ul><p>As with most of the claims, the Chinese battery capacities can only be taken with a gain of salt. User comment on he cheapest SKU:<em>&quot;Working battery, but capacity is only about 350mAh. Checked with imax charger.&quot;</em>  This is what my <a href="https://hackaday.io/project/4993-dual-channel-battery-chargeranalyzer">battery analyzer</a> is for.</p><p>So in theory, if the power consumption is on average 2mA, a device could be operated 24/7 for a week on these batteries.  2mA * 24Hr/day * 7 day = 336mA*Hr  This is a reasonable target.</p><p><img src="https://cdn.hackaday.io/images/5937671432213494743.jpg"></p><p>Li-ion batteries have voltages between 3.7V to 4.2V, so a buck converter with low quiescent current is what I would try to use. </p><p>I looked into the possibility of lowering the supply voltage for the microcontroller, but there don&apos;t seem to be much savings anyway as the power consumption for the VLPR (Very-low-power run mode) is below 1mA and stop mode is below 1uA. In VLPR, the internal LDO for the core voltage is reduced to bare minimal for 4MHz.  For this application, that&apos;s plenty of speed.</p><p>The dual buck converter <a href="http://www.diodes.com/datasheets/PAM2306D.pdf">PAM2306D</a> I used previously on my <a href="https://hackaday.io/project/1347-fpga-computereval-board">FPGA board</a> is quiet good for light loads.</p><ul><li><em>Input voltages from 2.5V to 5.5V</em></li><li><em>Only 40&#x3BC;A (Typ per Channel) Quiescent Current</em></li><li><em>Output Current: Up to 1A per Channel</em></li><li><em>Shutdown current is less than </em><em>0.1&#xB5;A</em></li></ul><p><img src="https://cdn.hackaday.io/images/372771432218062610.gif"></p><p>The 80% efficiency for loads below 10mA is roughly the same ballpark as a decent 3.3V LDO and doesn&apos;t offer saving.  The microcontroller is going to run off the battery directly with an ultra low quiescent current LDO.  A PMOS can be used to control the power to the 6-axis sensor from the LDO.</p><p>The haptic motors will be controlled by a pair of NMOS.  I will be driving the MOSFET directly from PWM pins.  Even at low frequency, it is still a good idea to keep the input gate capacitance low.  A low capacitance keeps the transition of On/Off short to minimize the losses in the MOSFET.  I have not decided whether it should be powered from the battery directly or via a buck converter.</p><p>Diodes Inc DMG1023UV-7 and DMG1024UV-7 are dual PMOS and NMOS that have 60pF capacitance at $0.59 (CAD).</p><p><img src="https://cdn.hackaday.io/images/8585051433508565653.png"></p><p>The Chinese Ultrasonic modules are for 5V.  Looks like I&apos;ll need to do some extensive modifications or reverse engineering.</p><p>As for battery charging, it&apos;ll need to be wireless charging (weight/size issues) or by some self aligned electrical contacts.</p><hr><p>Going with the 14500 battery.  There isn&apos;t much size savings over the 1/3AA difference.  The 14500 are more readily available.  If I add a boost circuit, I might be able to allow for a much cheaper and more readily available regular AA cell as an emergency back up.  The price for those non-rechargeable CR123A alone can get you a couple of replacement batteries.</p><hr><p>The battery arrived. (1 month+1 day)</p><p><img src="https://cdn.hackaday.io/images/5724491435102754684.png"></p><p>I would be very surprised if the capacity is near 900mAHr.  </p><p><img src="https://cdn.hackaday.io/images/519481435103844285.png"></p><p><br>Towards the negative terminal, you&apos;ll see the case slightly tapered off.  That&apos;s where the protection circuit resides.  There is a thin flat strip at the middle just right at the red/black seam is the connection to the positive terminal for the protection circuit.  </p><p><span class="redactor-invisible-space"><img src="https://cdn.hackaday.io/images/2514111435103099535.png"><span class="redactor-invisible-space">The gold terminal is from the protection PCB.  The battery is slightly thicker.<br></span></span>Contrary to internet believes, you&apos;ll need a proper charger for charging the battery. The protection circuit isn&apos;t a charger.</p><p><span class="redactor-invisible-space"><span class="redactor-invisible-space">In terms of weight:  <br>Trust Fire Li-ion: 20.3g, Duracell Alkaline: 23.7g, Energizer NiMH: 26.3g, Soshine &quot;700mAHr&quot; LiFePO4: 18.3g<br><br></span></span></p><em></em></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/5903/log/18329-ultrasonic-module-virtual-teardown">Ultrasonic Module Virtual Teardown</a></h2>
                            <small class="authorship">3 months ago  &bull;
                                <a class="gray-link" href="/project/5903/log/18329#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-18329"><p>I guess I'll order some modules to play around. The prices are lower than what I would pay for the Ultrasonic transducers.  Let's see how much reverse engineering I can do without having ones of these in my hand without waiting for 3 weeks or so.</p><p><img src="https://cdn.hackaday.io/images/1228381432312954627.jpg"></p><p>It is nice of <a href="http://www.dx.com/p/hc-sr04-ultrasonic-sensor-distance-measuring-module-133696">DX</a> to link a <a href="http://m5.img.dxcdn.com/CDDriver/CD/sku.133696.pdf">datasheet</a> and <a href="http://www.ic5188.com/PDF/HC-SR04.rar">sample code</a>.  <a href="http://www.elecfreaks.com/store/hcsr04-ultrasonic-sensor-distance-measuring-module-ultra01-p-91.html">ElecFreaks</a> has <a href="http://www.elecfreaks.com/store/download/product/Sensor/HC-SR04/HC-SR04_Ultrasonic_Module_User_Guide.pdf">english user guide</a>, <a href="http://www.elecfreaks.com/store/download/product/Sensor/HC-SR04/HCSR04Ultrasonic_demo.zip">demo</a> and <a href="http://www.elecfreaks.com/244.html">blog article</a>.</p><ul><ul><li>Model: HC-SR04</li><li>Working voltage : 5V(DC)</li><li>Static current: Less than 2mA.</li><li>Output signal: Electric frequency signal, high level 5V, low level 0V.</li><li>Sensor angle: Not more than 15 degrees.</li><li>Detection distance: 2cm~450cm.</li><li>High precision: Up to 3mm</li><li>Mode of connection: VCC / trig(T) / echo(R) / GND</li><li>Shipping Weight: 15g</li></ul></ul><p>They have a reasonable range, not bad on the power consumption (15mA during transmit) and should be easy to use.  On the other hand, I don't want to deal with 5V if I can help it.</p><p>I can turn off the power between samples to save the 2mA quiescent current.<br>8 * 1/40000 * 15mA x 10 per sec  x 2  averaged over 1 second is below 100uA.</p><p>There is a <a href="http://en.sg-micro.com/index.php?m=default.products_show&amp;id=18">SGM324</a> made by <a href="http://en.sg-micro.com/">SG-Micro</a> on the left hand side behind the receiver.  I haven't even heard of the company until today.  These are not your average "324", but are CMOS rail to rail I/O quad opamp. <a href="http://en.wikipedia.org/wiki/Gain%E2%80%93bandwidth_product">Gain Bandwidth Product</a> is 1MHz, so we should expect at most a gain of 25 at 40kHz from each of the individual opamp.  Depending on the gain requirement, I might use a LMV324 as they are cheap and easy to source or use something with a higher GWP.</p><p><img src="https://cdn.hackaday.io/images/2103491432314680557.gif"></p><p>The middle chip has no label. There is a 4MHz crystal Y1 connected to it. It could be a microcontroller that generates the 40kHz signal for the transmitter and filters out the received signal.<br></p><p>I found this on <a href="http://www.banggood.com/2Pcs-HC-SR04-Ultrasonic-Ranging-Sensor-Ultrasonic-Module-For-Arduino-p-943141.html">Banggood</a>.  Probably a picture of a old version as the design is different and the chip number is still there.  There are parts that got removed.</p><p><img src="https://cdn.hackaday.io/images/8967591432316760188.jpg"></p><p>Unfortunate I don't have the usual zoom-enhance-pan trick on CSI.  This is as far as I can clean up the picture.</p><p><img src="https://cdn.hackaday.io/images/3014431432317519009.jpg"></p><p>If I had to build a transmitter driven from a logic level, I would have used a <a href="http://pdfserv.maximintegrated.com/en/ds/MAX3222-MAX3241.pdf">MAX3232</a> to drive it at +/-10V p-p.  It has a charge pump for the +/- 10V, level translator and drivers that are designed to drive big capacitive load e.g. the 2200pF in a transducer.  The 5 capacitors near the 16 pin chip is what you would typically use for the charge pump and decoupling.  Pin 7 attached to the transmitter is a transmit pin on the MAX3232.  They could be using a version or a clone with internal charge pump and shutdown pin for the later revs.</p><p><img src="https://cdn.hackaday.io/images/9067051432319329194.gif"></p><p>Driving a <a href="https://cdn.hackaday.io/images/6577441432161320963.gif">transducer</a> with 2200pF at 40kHz is just north of 10mA, add in the extra current for the rest of the board, that's just about the 15mA transmit current quoted.</p><hr><p><strong>Edit</strong>: <a href="http://uglyduck.ath.cx/ep/titles.html">Emil</a> has done reverse engineering <a href="http://uglyduck.ath.cx/ep/archive/2014/01/Making_a_better_HC_SR04_Echo_Locator.html">here</a>.  I am right about the MAX2232!  They had replace the awful LM324 with the SGM324 and probably use a different microcontroller in the recent versions.</p><p><img src="https://cdn.hackaday.io/images/3416361432320887158.gif"></p><hr><h2>Possible Customization</h2><p>U1 can be implemented inside the ARM MCU (Freescale MKL16) by using a PWM output.  The same analog signal block for processing the received signals from  transducer can be shared by multiplexing the left and right inputs.  The new opamp should work fine at 3.3V, so not have to worry about voltage tolerance.  U2A block can be implemented in the CMP (Comparator) block inside the MCU.  There is an internal 6-bit DAC that can be used to dynamically reduce the threshold over time.  The output of the comparator have to be routed outside the MCU to a pin and back  to the input capture of the timer (TPM).  The analog signal can also be fed into ADC for sampling to extract the amplitude and timing of  the return echo envelopes.<br></p><p><img src="https://cdn.hackaday.io/images/7129181432341831544.gif"></p><p>Have to think about the Ultrasonic driver circuit and also see if I can somehow use 1 single transducer for both Tx and Rx to reduce size and weight.  This application would not require very close distances so 2 transducers is not needed.</p><hr><p>Saw a HaD link to <a href="https://www.sparkfun.com/products/12784">SparkFun ToF Range Finder Breakout - VL6180</a> which is interesting.  The more interesting part is the ad for the related product at the bottom:   <a href="https://www.sparkfun.com/products/8502">Ultrasonic Range Finder - LV-MaxSonar-EZ0</a>  The module is using a single ultrasonic transducer for both transmit and receive.  It claims that it can be used from 6 inches up and run from 2.5V to 5.5V  at 2mA.</p><p>6 inches ~ = 6 in / 13386 in/s = 448us.  So that's the upper limit of ringing on their transducer</p><p>The module however is not open sourced, so I probably won't be using it in the product.  It does offer some hope.  Whether the unknown transducers they used in the Chinese modules have necessary damping in it for half duplex, I'll have to find out when it arrives in 2+ weeks.  I'll probably need to do some measurements.</p><p>interesting links: <br><a href="http://www.ele.uva.es/~jesus/sonar/sonar.html">http://www.ele.uva.es/~jesus/sonar/sonar.html</a>  Single transducer design<br><a href="http://robotang.co.nz/projects/electronics/ultrasonic-rangefinder/">http://robotang.co.nz/projects/electronics/ultrasonic-rangefinder/</a>  Also single transducer design<br><a href="http://www.robot-electronics.co.uk/htm/srf1.shtml">http://www.shapeways.com/product/CYX7H44HZ/ping-ultrasonic-range-finder-range-extender</a></p><hr><p>Judging from the ebay/Chinese sites, the most likely part# that is on the module is: TCT40-16R/T-2 from <a href="http://www.shenghui.com">Sunway / Shenghui</a></p><p><img src="https://cdn.hackaday.io/images/7466651433292428717.jpg"></p><p>1.5ms ringing is about 51cm. </p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/5903/log/18341-lets-go-shopping">Let&#39;s go shopping</a></h2>
                            <small class="authorship">3 months ago  &bull;
                                <a class="gray-link" href="/project/5903/log/18341#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-18341"><p>The mobile phone parts are a god sent for this project as they are optimized for cost, size, weight and power which is what I am after.<br></p><p>Today, I  have ordered 20pcs of mobile phone vibration motors from aliexpress.   <a href="http://www.aliexpress.com/item/20pcs-1-5V-3V-Micro-mobile-phone-vibration-motor-4mm-coreless-motor-with-vibration-Free-shipping/2044508727.html">here</a> for $8.28 US with "Free shipping" via registered mail.  Not sure what I want to do with the rest of them yet. :)<br></p><p><img src="https://cdn.hackaday.io/images/2063141432330056056.jpg"></p><p>Compared to the usual ones I found, these are much more suited for SMT onto a PCB directly.  They have a flat surface and the rotating mass is within the height envelope.  Even if they melt or degauss inside my toaster oven, I can at least glue them.  The other ones I found have wires, in cylindrical shape or have the weight overhanging.  They'll cost more to handle them for manufacturing to strap/glue/make plastic part to hold them.</p><ul><ul><li>Motor specifications: 4*4.5MM (it is a 4*8 coreless motor after remove shell)</li><li>The motor length: 8MM (excluding eccentric)</li><li>Eccentric specifications: 3*3.5*3.8 MM</li><li>Voltage:1.5 V current:60 MA</li><li>Voltage:2 V current:80 MA</li><li>Voltage:3 V current:115 MA</li><li>working voltage range is 1.5V-3V,the rated voltage is 2V .</li></ul></ul><p>It is smaller than I thought and that's a very good news.  The power requirement is reasonable.  Not sure if I am going to use a buck converter to step down the voltage first or drive them from battery and account for that using PWM.</p><p>BTW: If you are lazy, use a <a href="http://www.onsemi.com/PowerSolutions/product.do?id=NCP5426">LDO</a> with an enable pin for driving these.  The LDO even has thermal and short circuit protection and the enable pin can be directly driven from an I/O pin of a microcontroller.  Probably should add a 0.1uF cap in addition to whatever the datasheet recommends across the motor to reduce the electrical noise.</p><hr><p>I haven't figure it all out yet, but why settle at simple beeps when I could have a Micro SD or SPI FLASH with stored voice samples.  This would make it so much easier for the end user than simple beep codes to report absolute distance. </p><p>The K16L ARM chip I picked has a DAC and even an 12S.  External FLASH storage are relatively cheap, I can probably use low sample rate uncompressed audio.  For noisy environments, the motor provides alternate feedback.  Thankfully, there are pin compatible members of the KL16 series with more on-chip FLASH should these new feature requires more space. </p><p> Cashed in my Teensy LC prize for this project.  The LC got a KL26 which has similar peripherals as the KL16, so it would be a good proto platform for part of the development until PCB get designed and populated.</p><hr><p>I bought 5 sets of Ultrasonic boards, 100 pcs of 2mmx1mm N50 magnets and a "TrustFire" protected 14500 (AA) battery from Banggood. When you put a Li-ion battery next to your head, it had better be a protected one instead of just a Lipo or unprotected cell.  I guess I'll find out how well the battery performs.  I read that they are much closer to 800mAHr, so that should provide really long battery life.</p><p>The battery is the first to arrived.  (1 month+1 day)<br>The ultrasonic module arrived next (1 month + 3 days)  This is the critical part for this project.</p><hr>I ordered a <a href="http://www.banggood.com/1_8-Inch-Serial-SPI-TFT-LCD-Display-Module-With-Power-IC-SD-Socket-p-909802.html">small LCD with SPI</a> for debugging last night.  I have been thinking of an auxiliary/expansion port for a while for adding new sensors to the basic design in the future.   It is also important for field debugging without lugging a laptop around.  As much as I think a ESP8266 as a web based display for a mobile device would be cool, this has to do.<p><img src="https://cdn.hackaday.io/images/7289431433968263661.JPG"></p><p>Probably going to do a small polar plot sonar display similar to the trackers in the original <em>Alien</em> movie.  :)  It is the most logic way of  visualizing what the sensor see. <br></p><p><img src="https://cdn.hackaday.io/images/1958551433968920676.jpg"></p><p>Link: <a href="http://forum.banggood.com/forum-topic-15994.html">Banggood forum topic for library</a></p><hr><p>And I thought Canada Post is bad, but there seems to be some China Post delays...  Shipment hasn't even showed up at Canada Post's hand yet.  Pretty scary stuff at the <a href="http://track-chinapost.com/?page_id=242/china-post-forum-group1/china-post-discussion-forum14">forum</a>.  Might have to open dispute for my motors as I don't see being able to get them before my buyer protection runs out.  </p><p>Okay.  I changed my mind Canada Post is also bad!  They are running late.  I don't think they have a working time machine either.</p><p><img src="https://cdn.hackaday.io/images/4200561436219234946.png" width="262" height="259" alt="" style="width: 262px; height: 259px; display: block; margin: auto;"></p><p><img src="https://cdn.hackaday.io/images/4258151436357613044.png"></p><p>It is finally on out for delivery status too.  It sure takes a very long time for the package to arrive from Toronto to Ottawa.  Hint: It is only a 1 hour flight.  I had packages from Canada Post that turns up in 1 business day before.</p><p>So far, I have seen 1 of my regular shipment from Banggood late for 1 week and another is 2 weeks past due based on their history.  These all seem to happen since last month.  The 2 weeks past due shipment is plastic washers, so it is not a safety/prohibited item issue.<br></p><p><img src="https://cdn.hackaday.io/images/2481441435005794860.png"></p><p><a href="http://track-chinapost.com/?page_id=242/china-post-forum-group1/china-post-discussion-forum14/help-order-not-received-thread9856">Saw  this</a></p><p><a href="http://track-chinapost.com/?page_id=242/china-post-forum-group1/china-post-discussion-forum14/important-china-post-new-policy-thread7602">Saw this</a><br>&gt;China Post announced a new policy since November 2014 that parcels with 
magnetic items, including headphone, radio, scanner ... will cause 
safety problem to airline and therefore not allowed to be shipped by 
airmail.</p><p>Motors, speakers and my neo magnets are magnetic.  :(</p><p>&gt;Appendix: China Post Forbidden Item List</p><ul>
<li>Battery item such as Mobile Phone, Walkie Talkie,Laptop, tablet,iPad etc. </li></ul><p>That could explain why my camera battery order went to Sweden and got mailed from there.  Round trip around the world took 8 weeks while the replacement for the late package sneaked pass the postal system and arrived in 5 weeks.</p><p>Might have to rethink my ordering and project strategy. I can certainly drop the motor for prototype and use dollar store head phones speakers for now.  I have a provision for Alkaline/NiMH AA cell and have a few LiFePO battery as well as some LiPo (non 14500) on hand, so no major changes there.</p><hr><p>They bulk shipped the speaker package with the airline.  Their bulk package arrived in Vancouver  20 days ago, but have no further activities.  May be I would see the speakers eventually.  Still no updates on the motor packages.  These Chinese sellers do not reply to email inquiries.  The package did arrived today (a month later).</p><p>Meanwhile the motor packages is in limbo.</p><p><img src="https://cdn.hackaday.io/images/808221434863310355.jpg"></p><hr><p>Wait did I see that on digikey supplier list!?  I always go sort by lowest price, so may be some day she'll surprise me?<br></p><p><img src="https://cdn.hackaday.io/images/9194661434678345709.png"></p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/5903/log/18392-that-old-spice-magic">That old Spice magic...</a></h2>
                            <small class="authorship">3 months ago  &bull;
                                <a class="gray-link" href="/project/5903/log/18392#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-18392"><p>I tried building a discrete  driver in LTSpice along with the transducer model from Microchip. The driver design is a modified version of the  pseudo push-pull from The Art of Electronics coincidentally for the 2000V ultrasonic transceiver.  The modification allows me to tristate the output just like a bus driver.</p><p><img src="https://cdn.hackaday.io/images/7767061432415223654.png"></p><p>I set up the model to drive 8 cycles at 40kHz, then the output low for 500us before going tristate. So what happens is that there is still a lot of kinetic energy stored inside the transducer even though I shorted its output. There is only so long you can short the transducer as it affects how close the range finder would work.<br></p><p><img src="https://cdn.hackaday.io/images/8405211432412801034.jpg"></p><p> I even tried 8 additional cycles that are 180 degrees out of phase, the amplitude decreased a little and then built up again.  I think I have gone down a dead end with this approach.  </p><p><img src="https://cdn.hackaday.io/images/5856811432420618617.gif"></p><p><img src="https://cdn.hackaday.io/images/3298861432424838990.gif"></p><p><img src="https://cdn.hackaday.io/images/2405171432482472794.gif"></p><p>There are others that managed to get a single transducer to work. It would require a special transducer! That explains it.  1.2ms is about 0.4m.  I'll stick with the separate Tx and Rx transducer approach.</p><p>I have built a LTSpice model of the receiver based on the reverse engineered schematic.  The circuit would work at 3.3V.  (I used the LMV324 Spice model as I couldn't find the SGM324 one.)</p><p><img src="https://cdn.hackaday.io/images/9766061432416679227.gif"></p><p>Here is the frequency response plot  with the 2 resistor values change that Emil suggested to move the frequency to 40kHz.  Not sure if that's already been incorporated into the new modules.</p><p><img src="https://cdn.hackaday.io/images/3209751432416920753.gif"></p><p>Because of the virtual ground rail (trace in blue) capacitance, it'll take at least 2ms before it settle down.   The output would follow the DC bias. Since the comparator circuit detects DC level, so it will be affected by this.  Looks like we could use a better virtual ground that settles more quickly - I can probably use that spare opamp which used to be the comparator.  The other approach is simply to power up the circuit ahead of time.</p><p><img src="https://cdn.hackaday.io/images/1994171432417273687.gif"></p><hr><p>So the big question are there any improvements in the current rev. of the module?</p><p>A couple of the resistor values was change around the bandpass filter of the <a href="https://cdn.hackaday.io/images/1178291435424190983.png">current version</a> of the modules, but the filter center frequency is still about 1/2 of it should have been.</p><p><img src="https://cdn.hackaday.io/images/1333191435695175762.png"></p><p>The new mid rail reference impedance is too high and resulted in an oscillation.  That does not agree with real life results.  Looks like I'll need to do some more work.</p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/5903/log/18560-more-virtual-prototyping-pcb">More virtual prototyping - PCB</a></h2>
                            <small class="authorship">3 months ago  &bull;
                                <a class="gray-link" href="/project/5903/log/18560#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-18560"><p>I am a big believer of doing my detail designs up front than to waste my time and money trying random things in a frenzy in the lab.  I started doing 3D modelling for my projects since my 2014 HaD contest project. They are not just pretty pictures to impress readers.  The more I used it, the more I am convinced that it is a very important step for checking badly made libraries.  Sometime the vendor&apos;s CAD drawing is wrong!</p><p>This following 2D CAD have missing dimensioning and wrong number. Top left hand corner, the length is actually 0.91&quot; instead of 0.71&quot;. There is no offsets in the drawing. There are no PCB footprints and suggestions on how far the 2 halves of the connectors should be.  </p><p>How likely are you to get this right in your first prototype?</p><p><img src="https://cdn.hackaday.io/images/4185411432773104818.gif"></p><p>Thankfully, the vendor provided a STEP model. I used <a href="https://eagleup.wordpress.com/">EagleUp</a> to export my PCB to SketchUp.  A few iterations later of fixing footprints and outline, this is what it looks like.  The <a href="http://www.3dcontentcentral.net">3D models</a> shows me contour around the battery and holder, so I can plan my component placements.</p><p><img src="https://cdn.hackaday.io/images/390521432778443755.jpg"></p><p>This is how much compression I think I&apos;ll need for the battery contacts. No amount of 3D modelling can tell you is how snug the fit is. I&apos;ll need to etch a PCB to test it out.</p><p><img src="https://cdn.hackaday.io/images/440421432778596681.jpg"></p><hr><p>A bit of update on the layout - just getting a feel on the size.<br>Under the battery: 1 LDO, 1 boost supply, 2 buck (step down) converter , 1 Li-ion charger.<br>Lower left hand corner: Ultrasonic receiver that is shared between left./right side with an analog Mux.  Need the transmitter <br>Lower middle: ARM + SPI FLASH.</p>Not in the layout yet:<ul><ul><li>Ultrasonic driver, amplifier, power management, MEMS.  They should fit in the board space.</li><li>Electro-mechanical (one set per side): Speaker , vibration motor, connector, ultrasonic Rx/Tx transducers.</li></ul></ul><span></span><p>Right now the strategy is to fit most of the control electronics on one side and run a cable as a glasses cord to the other side.  While this makes it slighter heavier for that side, it reduces a lot of the wires.</p><p><img src="https://cdn.hackaday.io/images/2820551433129345809.jpg"></p><p>The size could be further reduced by using smaller components for the ultrasonic receiver instead of reuse the parts from a module.  The bottom halve of the PCB could also be folded 90 degrees in a rigid/flex PCB. That&apos;s something to think about in a much later stage.</p><p><img src="https://cdn.hackaday.io/images/4161121433133915814.jpg"></p><hr><p>More conceptual 3D modelling of the main PCB with the ultrasonic transducer mounted at 90 degrees on a separate PCB.  There will be a much simpler PCB on the other side for just the transducer, motor and speaker.</p><p><img src="https://cdn.hackaday.io/images/5552191433479506041.png"></p><p>I have to waiting until the ultrasonic modules to arrive before I&apos;ll know if I can make it work using a single transceiver.  I am looking into modifying the circuits design and what I can to reduce the board space and power requirements.  Also waiting for the motors and speakers to show up to find out their size and the actual power requirements.</p><hr><p>Work in progress:</p><p><img src="https://cdn.hackaday.io/images/3126241433772174792.png"></p><p>Changes:</p><ul><ul><li>Switched to larger packages - LQFP 64 for I/O count as QFN48 was running a bit low, by the time you pay for a port expander, might as well use a larger package.  QFN was not available for that size.</li><li>I want to give the option of providing access to the amplitude of the return &quot;pings&quot;.  The ultrasonic receiver analog waveform can be sampled and the amplitude of the echo envelope can be extracted with some post processing and combined by firmware for stereo output which helps with orientation.  The low power MKL series doesn&apos;t offer multiple DAC, so I added I2S audio DAC.</li><li>Had to modify SOT526 land pad to meet minimum 6 mils clearance.  Added Debug connector</li><li>Thinner 0.031&quot; (0.79mm) PCB for some weight reduction.  Hopefully, it would be strong enough to resist bowing due to the battery holder.</li></ul></ul><p>Now basically waiting for the stuff from China to show up to make some measurements before I can finish designing the rest of the circuits and figure how I am mounting them.</p><ul><ul><li>How much power is the speakers going to need?  Is headphone amp sufficient or I need to up the wattage.  </li><li>Would I be able to use a single ultrasonic transducer?  Would I be able to reduce the drive requirement by upping the receiver gain?  Is there overshoot/undershoot from the transducer? </li><li>Speaker and motor dimensions and how to mount them?</li></ul></ul><p>The PCB will be extended toward the left side of the PCB for the motor, speaker, amplifier and connectors - for cable need to run to the other side - ultrasonic sensor(s?), motor, speaker.</p><p><img src="https://cdn.hackaday.io/images/7615611434399080888.jpg"></p><hr>Latest trial layout: <br>I like rearrange layouts and optimize them via iterations to make more optimal space usage.  More routing done - accelerometer, ultrasonic driver i.e. they are closer to their final resting place.  :P<ul><ul><li>Thermometer moved to the ultrasonic daughter card for better thermo isolation.</li><li>Going to use separate TX/RX transceivers - better for close distance </li><li>Relocated the audio DAC from the left side to the right side of the ARM chip by remapping the I2S.  This is to clear up more space on the left side for bulky parts like speaker, motor, audio amplifier, connectors etc.</li></ul></ul><p><img src="https://cdn.hackaday.io/images/1437691435848352204.png"></p><hr><p><img src="https://cdn.hackaday.io/images/3097321437035477001.png"></p>Resume working on this project as my <a href="https://hackaday.io/project/4993-dual-channel-battery-chargeranalyzer" target="_blank">Battery Analyzer</a> project preliminary routing is done.  Done a bit more design/routing.  As you can see, I am slowly packing the layout on the right hand side as routing progresses.<ul><ul><li>thermal sensor moved onto the transducer board further away from the layer of warm air surrounding the human head.</li><li>added a 2mm connector for signals to the left side.  For now, an IDC ribbon cable would have to do.</li><li><span></span>picked a Class D Audio amplifier - Diodes Inc <a href="http://www.diodes.com/?q=catalog/Audio_71/PAM8404_9184">PAM8404</a> in QFN package.  Shutdown current is less than 1uA (typ) which simplifies the power management as I don&apos;t need to switch off its power with a MOSFET.  It also has independent left/right channels shutdown pins which allows for more aggressive power management.</li><li>made footprint/3D model for haptic motor.  I played a bit with the motor and decided to change the driver circuit from a simple MOSFET to a low impedance MUX as half bridge driver. This allows for tighter motor control as dynamic braking can stop the motor spin pretty quickly.  The draw back of this design doesn&apos;t allow for PWM, but given the weak motor that might not be an issue.  TI&apos;s driver <a href="http://www.ti.com/product/drv2603" target="_blank">DRV2603</a> would have been nice here if only it would work from 1.5V directly.</li><li>I am going to try increasing the board size vertically to ease the routing congestion between left and right side surrounding the ARM chip.  I am resisting the urges to cut up the ground plane too much under high speed signals.</li></ul></ul><hr><p>After a lot of procrastinations, the preliminary board layout is done - well sort of.  I still need to order the parts early next week and try out a couple of speakers and make decisions on a few connectors before committing to a layout for PCB manufacturing (hopefully next week).  Also have to do a break out board for the left side for the sensor, speaker and haptic motor.</p><ul><ul><li>added EMI filters to the speaker outputs of the <a href="https://en.wikipedia.org/wiki/Class-D_amplifier">Class D Amplifier</a></li><li>consolidated the power control for SPI memory and audio DAC.</li><li>the board size has been increased vertically.  </li><li>Sensor board has be resized to match.  </li><li>Tempted to do round corners for the PCB.</li><li>Have to decide on speaker connector, debug connector, and spare I/O.</li></ul></ul><p><img src="https://cdn.hackaday.io/images/8476251437144874147.png"></p><hr><p>I extended the transducer PCB (vertical PCB) downward so that the right angle connector is no longer hanging during assembly.  I am leaving a gap of 0.005&quot; (0.127mm) for tolerance/warpage etc.  </p><p>It seems to me that the most logical way of assembling the PCB is to have the headers in the main PCB as there are multiple through hole parts, so they could be wave soldered.  I have rotated the transducers by 90 degrees so that their pins are more readily accessible for replacement.</p><p><img src="https://cdn.hackaday.io/images/4462091437152263365.png"></p><hr><p>A few connectors later, this is how it looks.  Now there are 2 UART, I2C, SPI, SWD and power on the two 8 pins connectors.</p><p><img src="https://cdn.hackaday.io/images/1596791437433157224.png"></p><hr><p>Here is the breakout PCB on the left hand side.  It shares the same sensor bare PCB, but with different stuffing option and orientation. The idea is to make all the 3 PCB on to a 100mmx50mm PCB that is on sale.  The two sides are connected by cable which also acts as a cord.</p><p><img src="https://cdn.hackaday.io/images/5847661437713276953.png"></p><p>The connector is mounted differently to maintain the same offset as the right side.</p><p><img src="https://cdn.hackaday.io/images/2447641437714251416.png"></p><hr><p>Here is how the 2 sides look.  Ignore the white PCB as EagleUp hasn&apos;t figure out how to render the PCB textures for multiple sub PCB in a panel. There is still that upper right hand corner piece which I&apos;ll probably find something to fill it.  I&apos;ll try to fit multiple design on a 100mm x 50mm panel Chinese proto PCB deal if I can help it. BTW I am funding this out of my own pocket.  The Chinese PCB house that I am using actually has a bit more aggressive design rules than OSH Park and I have great success reflowing fine pitched parts onto them.<span class="redactor-invisible-space"></span></p><p>The Sensor PCB are done as a  part - it is Sketchup3D imported PCB with the header pins.  Much easier to deal with on the board layout side too as a component in the library.  I tried to line up the components - cable connector, sensor board, the haptic motors and hopefully the illusive speakers.  You want the last 3 to be symmetrical. </p><p>The sensor boards are the same on both sides, but the connector(s) orientations are different.  The main goal is to minimize the PCB area which help to reduce weight.  I reuse the PCB as I am cheap - getting 5 sets of PCB for prototypes for $12 plus $6 shipping isn&apos;t bad.  The left breakout board has more space to play with, but it needs 4 connections to the sensor board.  Have the bent header side on the breakout PCB and use the lower row connector on the sensor board is the only way to accomplish that.  The right side has a much density board density, but allow the connections to the sensor PCB spread out more, so the vertical orientation and the upper row connection on the sensor PCB is used.  That upper row however is at the corner of the transducer, so only enough space for 2 connections per corner.</p><p>I haven&apos;t quite decided what to do with the speaker as that and the case design is a good sized project.  That&apos;s probably going to have to be something for next year&apos;s &quot;Best product&quot; entry.  Right now just need to concern with getting the prototype out to be a semi presentable state for the contest.</p><p><img src="https://cdn.hackaday.io/images/6045051437749652720.png"></p><span></span></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/5903/log/18803-power-supply-design">Power Supply Design</a></h2>
                            <small class="authorship">3 months ago  &bull;
                                <a class="gray-link" href="/project/5903/log/18803#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-18803"><p><img src="https://cdn.hackaday.io/images/5964161433197270164.png"></p><p>The power supply in this design is a bit complicated as I have tried to accommodate the use for AA Alkaline battery for emergency usage as well as for international shipping due to postal safety regulations.  </p><p>Aggressive power management is used to maximize battery life.  The power supply is partitioned in segments so that the inactive peripherals can be powered off via P-type MOSFET (<a href="http://diodes.com/catalog/p_channel_20v_145/dmg1023uv.html">DMG1023UV-7</a><span class="redactor-invisible-space"><a href="http://diodes.com/catalog/p_channel_20v_145/dmg1023uv.html"></a>).</span></p><p>I found this <a href="http://www.onsemi.com/pub/Collateral/NLAS4157-D.PDF">NLAS4157</a> from ON Semiconductor. It is a low resistance high current SPDT analog Mux designed for speaker for cell phone for $0.59 (CAD). The crosstalk specs isn't that great outside of audio frequency. It can also be used as a SPDT power switch as it is more power/space/cost effective vs discrete components.</p><ul><ul><li>Continuous current +/- 300mA (absolute max) and about 2 ohms or lower switch on resistance.</li></ul></ul><p><strong>Li-ion</strong></p><p>A 14500 (AA form factor) protected Li-ion battery is used to power this device.  A Li-ion charger (<a href="http://www.skyworksinc.com/Product/1132/AAT3693">AAT3693</a>)  is used to charge the battery. For the prototype, I'll use a micro USB connector. I'll look into additional charger connector/contacts that doesn't involve lining up tiny connector after prototyping stage.</p><p><strong>Freescale MCU</strong></p><p>In VLPR mode,  Freescale MKL16 core consumes 255uA (typ) while executing code in this mode.</p><p><img src="https://cdn.hackaday.io/images/1620461434299158451.png"></p><p>Power saving can be achieved by putting the core in LLS during idling.  This is the lowest power mode that the core can still recover via interrupts.  </p><p><img src="https://cdn.hackaday.io/images/6939791434299917166.png"></p><p><img src="https://cdn.hackaday.io/images/6432491434300344347.png"></p><p style="margin-left: 20px;">Note: Active peripheral also consumes additional power.</p><p>In deep sleep, the power can be restored by power cycling the switch and I'll probably use a momentary button and/or touch input for powering it up. The selector switch also has a 3rd position for turning it off during storage/shipping<span class="redactor-invisible-space"><br></span></p><p>A micropower LDO (<a href="http://www.microchip.com/wwwproducts/Devices.aspx?product=MCP1700">MCP1700</a>) is used to generate 3.0V for the MCU in run mode as well as sleep mode. The low quiescent current (1.6µA typ 4uA max) makes this part ideal for battery operation.<span class="redactor-invisible-space"><br></span></p><p><strong>6-axis MEMS</strong><span class="redactor-invisible-space"><strong></strong><br></span></p><p><span class="redactor-invisible-space">The 6-axis MEMS (<a href="http://www.freescale.com/webapp/sps/site/prod_summary.jsp?code=FXOS8700CQ">FXOS8700CQ</a>) is also powered from the same LDO 3.0 supply. The device can run in low power mode (~8uA) and can be used to interrupt and wake up the MCU when it detects movements. It can be shut off to save power in deep sleep via a PMOS switch.</span></p><p><strong>Peripheral Supply</strong></p><p>A buck converter (<a href="http://www.skyworksinc.com/Product/1328/AAT2120">AAT2120</a>) is used to step down the Li-ion to 1.5V or 3.0V for the more power hungry peripherals. The converter can be shutdown by deasserting  the enable input. It can goes from off to full regulation within 100µs. This allows for very aggressive power management.  By changing the voltage divider under program control, the converter can also output the 1.5V for the haptic motors.</p><hr><p><strong>AA Cell Mode</strong><br></p><p>While this mode is intended as an emergency back, I'll still try to optimize the power consumption.</p><p>A high efficiency boost converter (<a href="http://www.microchip.com/wwwproducts/Devices.aspx?product=MCP1640">MCP1640</a>) is used to generate 3.3V supply from an alkaline/NiMH battery.  During low load, the MCP1640 automatically switches to PFM (<a href="https://en.wikipedia.org/wiki/Pulse_Frequency_Modulation">Pulse Frequency Modulation</a>) mode to maintain good efficiency. </p><p><img src="https://cdn.hackaday.io/images/4851591434298048241.png"></p><p>The PFM quiescent current is 19µA (typ) 30µA (max).  While this might sound high, the amount of battery capacity for 2 weeks, 16 hours days is only 4.25mAHr out of  ~2700mA*Hr of an <a href="http://data.energizer.com/PDFs/E91.pdf">Energizer E91 Alkaline AA</a>.  19µA<span class="redactor-invisible-space"> x 16 hours/day x 7 day/week x 2 weeks = 4.256mA*Hr</span></p><p>The 3.3V is regulated down to 3.0V in this mode. Since the LDO is there might as well use it to protect the MCU in case of an incorrect battery switch setting.  The motor in this mode is powered from the AA battery directly to improve efficiency.</p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/5903/log/18852-some-like-it-hot">Some like it hot</a></h2>
                            <small class="authorship">3 months ago  &bull;
                                <a class="gray-link" href="/project/5903/log/18852#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-18852"><hr><p><img src="https://cdn.hackaday.io/images/457781433269859155.jpg" width="314" height="247" alt="" style="width: 314px; height: 247px; float: left; margin: 0px 10px 10px 0px;"></p><p>Got a hot air SMT tool ordered. This should make life much easier to work with the small parts as well as transplanting the parts from the Ultrasonic modules. This is DOA as there is a break inside the cabling for the temperature feedback which is not a very safe thing.</p><p>Shown here with error message. It makes a lot of sense why the thermal couple reading was going all over the map. Even though I could fix it by cutting off the last 7-8cm of the cable and reconnecting it. Having the cabling fails DOA makes me question the long term reliability of the wires used inside the cord.</p><p>When it did work, it is very quiet and the handle is much lighter than it looks. It also heats up fast.</p><hr><p>New $60 US hot air tool arrived.  This one works.  Not too crazy about the soldering iron as I am mainly using hot air.  </p><p><img src="https://cdn.hackaday.io/images/448831435265595045.jpg"></p><p>Going to be handy for SMT assembly work.</p><p>Seems like they have gone out of their way of not having a company logo at all!  Nothing on the back, in the manual nor inside! </p><p>Fun fact: <a href="https://en.wikipedia.org/wiki/No_Name_%28brand%29">no-name</a><span class="redactor-invisible-space"> products exists IRL and not just in the "Repo Man" movie!</span><br></p><hr><p>Curiosity kills the cat...  Had to open it up.  Got to have some filler or this project log is a bit short and boring...  </p><p><img src="https://cdn.hackaday.io/images/2824831435947897770.jpg"></p><p>The massive black object at the back is the <a href="https://en.wikipedia.org/wiki/Diaphragm_pump">diaphragm pump</a><a href="https://en.wikipedia.org/wiki/Diaphragm_pump"></a> - it works on 110V AC, has a reserve tank.  it is sitting on shock mounts!   The tube on the top side is the air inlet.  It is loud and not sexy, but I like it that way.  I suspect that they might use the same pump as suction for their de-soldering tool.   May be this could be double duty as the suction for vacuum pick up tool one of these days when I get bored?</p><p>Some of their other models has gone to the brushless blower at the tool side.  I suspect it is the same design as the Sigma R700.  BTW when I switch on the soldering iron without plugging it, the LED also reads 5-E.  I think they are at least using same firmware if not the same design.  The advantage is that it more quiet and not to have drag around a bulky air host while you work.  I wasn't impressed at the cheap wires they had on the Sigma.  Running the 600W heater on cheap wire is a disaster waiting to happen.</p><p><span></span></p><p> The cable is a combination of air hose and wiring harness to the hand held unit which includes the heater.  The transformer is always on.  Someone decided not to install an On/Off switch at the punched out panel on the back side which is now covered with a sticker.  </p><p>The main PCB looks green, but it is not FR4.  Probably <span class="st">phenolic</span> with green dye.  The air speed is controlled what looks like a dimmer switch - a TRIAC with a LM555 phase control circuit at the lower left of this.  The reason why I opened it up was to see if I could turn down the air flow a bit.  Not going to touch the 10 turns trim pot there.  The air temperature is via some feedback control of some kind.  There is a LM358 dual opamp (for signal conditioning?) at the upper left corner. </p><p> The centre top is a socketed Samsung chip - the manual confirmed that it is a microcontroller.  They claim that they are using digital PID loop for temperature control.  Display is on the right hand side.  There is a SMT chip under there probably a display driver.  </p><p>The bottom section is for the soldering iron.  I have enough irons in my collection, so won't be using it for now.</p><p><img src="https://cdn.hackaday.io/images/1487941435947978761.jpg"></p><hr><p>If you ever have the air flow is so high even at the lowest setting that it keep trying to blow your tiny parts away, here is a reversible way of reducing air flow.  Instead of pushing the tool tip all the way in, leave a tiny gap for some of the air to leak out.   </p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/5903/log/18868-math-is-cool">Math is cool!</a></h2>
                            <small class="authorship">3 months ago  &bull;
                                <a class="gray-link" href="/project/5903/log/18868#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-18868"><p>The dual range finder and accelerometer should enable the device to perform the following functions:</p><h2>Hallway navigation<br></h2><h2></h2><p>Two range finders (one for each side) are located on a pair of glasses separated by width <em><strong>w</strong></em>. As the user walks towards a wall at an angle ϴ, each of the range finders would return different distances <em><strong>d1</strong></em> and <em><strong>d2</strong></em>.</p><p><img src="https://cdn.hackaday.io/images/1887261433284617543.png" style="width: 634px; height: 259px;" width="634" height="259"></p><p>With simple geometry, the angle ϴ can be worked out.  The device can then inform the user how much correction is needed to stay parallel to the wall. </p><p style="margin-left: 20px;">tanϴ = <em><strong>w</strong></em> / (<em><strong>d1</strong></em> - <em><strong>d2</strong></em>), so  ϴ = arctan( <em><strong>w</strong></em> / (<em><strong>d1</strong></em> - <em><strong>d2</strong></em>) )</p><h2>Stairs detection</h2><p>As the user walks towards a staircase, he/she can detect the location of the stairs as well as the depth.</p><p><img src="https://cdn.hackaday.io/images/851521433289590335.png" style="width: 526px; height: 343px;" width="526" height="343"></p><p>We can calculate the following from what we know or measure.  Angle ϴ - measured by the Accelerometer; distance <em><strong>l</strong></em> return by the range finder while  <strong>h</strong> is<strong> </strong>the height of the transducer from the floor.</p><p style="margin-left: 20px;">depth of the stair from the sensor is <strong>h2</strong> = <em><strong>l</strong></em> x cos ϴ   so the relative depth of the stairs is <em><strong>h2</strong></em> - <strong>h</strong><br>distance from the step is <em><strong>d</strong></em> = <em><strong>l</strong></em> x sin ϴ</p><hr><p>Fixed point trig library: <a href="https://code.google.com/p/libfixmath/">https://code.google.com/p/libfixmath/</a> <br>Benchmark <a href="https://code.google.com/p/libfixmath/wiki/Trig_Math">https://code.google.com/p/libfixmath/wiki/Microcontroller_Usage</a></p></div>
                            </div>
                        </li>
                    
                </ul>

                
                <div class="pagination">
                    
                    
                    <a href="?page=2" class="grey-gold-button next-button show">Next</a>
                    
                </div>
                

                

                </p>

            
        </div>
    </div>

    










<div class="footer" id="footer">
  <a href="#header" class="back-to-top" onClick="CT(this, 'Footer', 'GoingUp');">^ Going up? ^</a>
    <div class="container">
        <p><a href="http://hackaday.com/about/">About Us</a> <a href="mailto:projects-contact@hackaday.com">Contact Us</a> <a href="/project/37">Give Feedback</a>&copy; 2015 Hackaday <a href="/tos">Terms of Use</a> <a href="/privacy-policy">Privacy Policy</a></p>
        <a href="/" class="had-skull"  onClick="CT(this, 'Footer', 'Home' ); return false;">Hackaday.io</a>
    </div>
</div>

<script>

    var csrftoken = '8FYJJFQW-838sSFmMZ2fXgJ0BiRJ0sKWV1Mc';

</script>

    <script type="text/javascript">

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-47229708-1', 'auto');

    var dimensionValue = 'nonregistered';
    ga('set', 'dimension1', dimensionValue);
    ga('require', 'displayfeatures');

    ga('send', 'pageview');

    </script>

<img src="//analytics.supplyframe.com/trackingservlet/impression?action=pageImpression&amp;zone=HIO_logs&amp;extra=logged%3Dfalse%7ChaveAccountCookie%3D0%7C&amp;ab=undefined" class="sf-impression" />

    
    
    <script src="//cdn.hackaday.io/build/h%2FydgsYIeDTf7pqgYQEKK8Ngblw0IkZCDqfJ9S2tk7zsBoxIHt5iOd49Qp%2BF4vdxEuRj%2BGpGDLbX4aGOQGmbjaOxUZvklg4ReFk68R95OQshFrGKebvogKGQOiB5Hi1xym9KC54c9Ps0WpzuNydLk4B%2FbKi91KhV40Uxhl38XXb1IVAxAI8iW%2BoQUPCFkHVWZxD0B%2BMZ%2BuEXJTlWuBmopNMxTHRK5yleITPZODT6evbVRQc6AXs9w2Pfk7FS2nKy-0.48.6.js"></script>

</body>
</html>