<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie9" lang="en"> <![endif]-->
<!--[if gt IE 9]><!--> <html class="no-js" lang="en" ng-app="buildlogApp"> <!--<![endif]-->
<head>
    
    <title>Project logs &bull; Sonar for the visually impaired &bull; Hackaday.io</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="//cdn.hackaday.io/css/style.css?version=0.48.6" />
    <script type="text/javascript" src="//use.typekit.net/ymb0lgk.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>
<body class="logs">

    <!--
############################################################################################
############################################################################################
############################################################################################
#####################Kt;tL#######################################Kti,E######################
#######################;   .###################################G    E#######################
#######################K    f##################################    ;########################
########################Wj   E###############################K:  .W#########################
##########################.  :E##############################:  .L##########################
#########################D    f##############################.   .##########################
########################,     ;##############################     :E#######K################
################f######K      ,##############################      ,######Lt################
################  W###W       i##############################       t####j t################
################:  E#L.        f###########################L.        f#Ki .E################
################j  ;E.          j##########################.         .G;  i#################
#################L               i#######################K                ##################
#################W                E#####################K;               ;##################
###################:               .###################D               :f###################
#####################DLfGD           G####WEEEEKW####W           ;GffGK#####################
##########################i         iD##Kfi    :jKW##D          iE##########################
###########################W      ,G##f            jE#E;       j############################
############################L     D##D              ,##K       W############################
#############################D:  G#W                  K#E,   G##############################
###############################;i#L                    j## ,E###############################
###############################KK#.                     ##iE################################
#################################j                      ;K##################################
################################W                        ,##################################
################################E                         ##################################
###############################Ki                         D#################################
###############################E.                         L#################################
###############################f    iD##W;       D###D    :#################################
###############################i   i######K     K#####K;   #################################
###############################;  .E#######     #######D   #################################
###############################;  L########     ########   #################################
###############################i  G#######K     K#######   #################################
###############################j  L#####E,       fE#####   #################################
###############################D  .E##j            .t##E  ;#################################
###############################E:  ;##.              #Wt  j#################################
################################G   ;t      tWi      t    E#################################
#############################KL##           K#K;          #K:K##############################
#############################i ##:          ###t         j#f ;K#############################
############################:  G#K          #E#L        L##    D############################
###########################D   ;W#:         #;#L        W#K    .############################
#####################KKEKK      :##L        ; ..      :D##.      fKEEK######################
###################t.            ;##G:               ,##E,             tD###################
##################G               E##E               i##;               :###################
#################D                W##W    iL    E.    ###D                ##################
################W,               G###W    tG    K.    ####:               K#################
################;  LW;         ,E#####:  ;W#    #G   f#####;         ;KG  :K################
################  D###E       ;########WW####WW####WW#######W       :####: j################
################ ,#####:      ;##############################       G####E i################
################K#######.     ;##############################      L######WG################
########################f     i##############################     j#########################
#########################W   .D##############################.   i##########################
#########################E   G###############################D   ,##########################
########################G:   #################################j   G#########################
#######################f    K##################################j    W#######################
#####################Kt :iE#####################################KL:  K######################
############################################################################################
############################################################################################
############################################################################################
-->

<div class="header" id="header">
    <div class="container">
        <h1 class="logo">
            <a href="/" title="Hackaday.io Home" class="home" onclick="CT(this, 'Menu', 'Home'); return false;"></a>
            <a href="/" title="Hackaday.io Home" class="brand" onclick="CT(this, 'Menu', 'Home'); return false;">Hack a Day</a>
        </h1>

        <a href="javascript:void(0);" class="responsive-menu">Menu</a>

        <ul class="nav" role="navigation">
            <li><a href="/projects" class="">Projects</a></li>
            <li><a href="/lists" class="">Lists</a></li>
            <li><a href="/stack" class="">Stack</a></li>
            <li class="dropdown more-nav j-more-open">
                <a href="javascript:void(0)" class="dropdown-link icon-dropdown">More</a>
                <ul role="menu" class="dropdown-menu more-menu" id="j-more">
                    <li><a href="http://hackaday.com/blog/" target="_blank">Blog</a></li>
                    <li><a href="/events">Events</a></li>
                    <li><a href="/hackerspaces">Hackerspaces</a></li>
                    <li><a href="/hackers">Profiles</a></li>
                    <li><a href="/contests">Contests</a></li>
                    <li><a href="/prize" target="_blank">The Hackaday Prize</a></li>
                    <li><a href="/submissions/prize2015/list">2015 Prize Entries</a></li>
                </ul>
            </li>
            <li class="menu-last-child">
                <div class="search-holder show">
                    <form id="search-form" action="/search" onsubmit="return submitSearch();" method="GET">
                        <input type="text" placeholder="Search" name="term" class="input-search j-add-search" id="j-add-search" value="" autocomplete="off" pattern=".{3,}" required title="3 characters minimum" />
                        <input type="submit" class="search-button" />
                    </form>
                </div>
            </li>
        </ul>

        

            <ul class="nav pull-right" role="navigation">
                <li><a href="/signup" class="grey-white-button become-member">Sign up</a></li>
                <li><a href="/signin?returnUrl=%2Fproject%2F5903%2Flogs%3Fpage%3D3">Sign in</a></li>
            </ul>

        
    </div>
</div>

<div id="topMessage" class="alert"><span class="j-top-content"></span><a href="javascript:void(0);" class="alert-close j-top-message-close">Close</a></div>




    <div class="headline">
        <div class="container">
            <h2><a href="/project/5903-sonar-for-the-visually-impaired">Sonar for the visually impaired</a></h2>
            <p class="description-title"> Project logs</p>
            <p class="description-summary">This is a low cost portable Ultrasonic range finder and sonar device to help a visually impaired person navigate indoors.</p>
            <div class="description-metainfo">
                
                    <span>created by <a href="/hacker/10708-kc-lee" title="Visit Profile">K.C. Lee</a><span>&bull;</span>
                
                3 months ago<span>&bull;</span><a href="/project/5903#discussion-list" title="See Comments">4 Comments</a></span>
            </div>
        </div>
    </div>

    <div class="container post-content">
        <div class="section-buildsort">
            <span class="pull-left">
                <a href="/project/5903-sonar-for-the-visually-impaired">&#171; Back to project details</a>
            </span>
            <span class="sort-holder pull-right">
                <label for="sort-by">Sort by:</label>
                <select class="sort" id="sort-by">
                    <option value="/project/5903/logs/sort/newest">Newest</option>
                    <option value="/project/5903/logs/sort/oldest" selected="selected">Oldest</option>
                </select>
            </span>
        </div>
        <div class="section section-buildlogs last">
            

                <ul class="buillogs-list">
                    
                        <li>
                            <h2><a href="/project/5903/log/21487-code-name-swiftlet-pcb-fab">Code name &#34;Swiftlet&#34; - PCB Fab</a></h2>
                            <small class="authorship">25 days ago  &bull;
                                <a class="gray-link" href="/project/5903/log/21487#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-21487"><p>Going to take a little break from codenaming PCB after Comic book characters as they don&apos;t quite have the fit for this project.  Code name for this PCB is &quot;<a href="https://en.wikipedia.org/wiki/Swiftlet">Swiftlet</a>&quot;.  It is an agile little bird that use simple but effective echolocation for navigating caves in total darkness.</p><p>Here is the the latest PCB in a panel.  I am going to go over that and might order the PCB later tonight if everything looks right.</p><p><img src="https://cdn.hackaday.io/images/3283871437778659373.png"></p><p><img src="https://cdn.hackaday.io/images/3055661437778672662.png"></p><hr><p>Files sent to PCB Proto place.  Time for this little bird to fly.  Initial proto PCB build are now on my <a href="https://github.com/FPGA-Computer/Swiftlet">Github</a>. </p><hr><p>The PCB vendor sent me this picture this morning.  That looks like my PCB.  The main PCB is slightly bigger than a 2 AA battery case.  The silkscreen alignment on the front actually looks right too. That speaker grill came out but looks different.  I&apos;ll have to measure it at some point.</p><p>It is going to be taking the long way home on the postal system.  They are using paypal postal labels and I have been told that tracking won&apos;t be available for 3-4 days.  China Post seems to be slower since earlier this year.</p><p><img src="https://cdn.hackaday.io/images/51291438164550731.jpg"></p><p>Paypal package:</p><p><img src="https://cdn.hackaday.io/images/4679611438384481931.jpg"></p><p>It is going to take a slow trip up north to Beijing where the International mail get sent out.  My <a href="https://hackaday.io/project/4993-dual-channel-battery-chargeranalyzer/log/21663-pcb-status">other project</a> is taking the same trip a couple of days earlier.</p><hr><p><img src="https://cdn.hackaday.io/images/7763271438521755442.jpg"></p><p><img src="https://cdn.hackaday.io/images/6314381438777225324.png"></p><p>Last entry: 5th Aug: Flight departure from Bejing.  It would take about a day to arrive in Canada.<br>It missed the flight on 3rd Aug by a few hours and got on flight on 5th.  It would seem like flights are every other day.</p><hr><p>Still no status update on the arrival.  Hope it didn&apos;t run into <a href="http://www.washingtonpost.com/blogs/capital-weather-gang/wp/2015/08/03/super-typhoon-soudelor-devastates-saipan-spins-toward-okinawa-taiwan-and-china/">Super Typhoon Soudelor</a>.  Meanwhile the PCB of my other project that left China is still sitting at the Canada Custom for the 3rd day.</p><p><img src="https://cdn.hackaday.io/images/9044751438989099051.png" width="513" height="393" style="width: 513px; height: 393px;"></p><p>Right now the postal delay really ties my hand.  I was hoping to get the PCB assembled and have at least a week working on the firmware.  Given the slow Canada Custom, I would be luck at all to get the bare board before end of next week.  Canada Post isn&apos;t know to be speedy, so it&apos;ll take them at least 2 days (and likely more) to just move a package from the west coast to the east.</p><hr><p>This is crazy.  My package went all the way up to Bejing, then took another trip back down south to Hong Kong (which is 45 minutes next door to the PCB place), then supposedly arrived in Vancouver the the 6th.  It basically wasted 1 week for a big tour in China.  Canada Post still have no record that they have received it.</p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/5903/log/21599-hello-hell-desk">Hello Hell Desk?</a></h2>
                            <small class="authorship">23 days ago  &bull;
                                <a class="gray-link" href="/project/5903/log/21599#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-21599"><p> have been putting off doing this next part - working on porting ChibiOS.  I guess that&apos;s one of the things on my to do list before the PCB comes back.  Not into the whole makefile command line nor linux nor run weird environment over on Windows nor making my tool chain.</p><p>There is a new stable release of ChibiOS 3.0.0  <a href="http://sourceforge.net/projects/chibios/">here</a> on July 12th which was 9 days ago.  I guess that&apos;s the one I should be porting over. </p><p>The C compiler include path is as follows:</p><p><img src="https://cdn.hackaday.io/images/6292021437969982730.png"></p><p>I am trying to play with RVCT.  Right off the bat, the supplied &quot;RVCT&quot; assembly file don&apos;t work directly as they added a whole pile of C preprocessor junk to what should have been a simple assembly file.</p><p><img src="https://cdn.hackaday.io/images/8133521438003241593.png"></p><ol><li>First thing to do is to right click the Project. In the Asm tab, add the &quot;--cpreproc&quot; option under Misc Control.  This runs the assembly file through the C Processor, so now those proeprocessor command would work.</li><li>Add in the include path: &quot;.\myprojects;.\os\rt\ports\ARMCMx;.\os\rt\include&quot;  <br>Note:  .\myproject is where I put the chconf.h.</li></ol><p>At this point, I get the errors down to a manageable 2.  So I guess it is not too bad so far.  Next thing to do is to play with the starup code where the errors come from.  </p><p>Right now I am just going to use the KL25 Freedom board files as initial port as it is the little brother of KL26 on the Teensy LC (minus the I2S.)</p><hr><p><a href="http://forum.chibios.org/phpbb/viewtopic.php?f=16&amp;t=2691">.\obj\ch.axf: Error: L6218E: Undefined symbol Image$RW_IRAM1</a><br></p><p style="margin-left: 40px;"><span class="redactor-invisible-space"><em>&quot;The missing symbol is the result of a change in the keil compiler, $ 
become an escape character so it should be replaced by $$ in the linker 
settings. I will check both 2.6 and 3.0 projects.</em><em>&quot;</em></span></p><p><span class="redactor-invisible-space">Except we need &quot;$$$$&quot; where we had &quot;$$&quot;.  Fixing that, the OS compiles error free.</span></p><hr><p><span class="redactor-invisible-space"></span></p><p>Bricked my Teensy LC after I erased the FLASH and try to program in a test image.  What really happened is that ChibiOS code have poor RVCT and Freescale support.  The supposedly stable code has<strong> </strong><em><strong>not</strong></em> been verified!</p><p><img src="https://cdn.hackaday.io/images/3799601439304669689.png"></p><p>Guess what guys?  RVCT not only did not reserve a space at $400 for it, but nukes that .cfmconfig block away.  If you now program this in, there is a very high chance that the chip has been irreversibly bricked. i.e. The bulk erase function is disabled too.</p><p>I modified the Freescale start up assembly code and it works as expected:<br></p><p><img src="https://cdn.hackaday.io/images/6189701439305613376.png"></p><h2>So lessons of the day:</h2><ul><li><span></span>Always check the map file!</li><li>Don&apos;t try to try to pretend that stuff is portable and even try to code that in C.</li><li>GCC section might not be portable across compiler.</li></ul><p>Forum topic is here: <a href="http://forum.chibios.org/phpbb/viewtopic.php?f=26&amp;t=2765">http://forum.chibios.org/phpbb/viewtopic.php?f=26&amp;t=2765</a></p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/5903/log/22668-change-of-plans-pcb-package-in-limbo">Change of plans - PCB package in Limbo</a></h2>
                            <small class="authorship">6 days ago  &bull;
                                <a class="gray-link" href="/project/5903/log/22668#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-22668"><p>The bare PCB is still in <a href="https://hackaday.io/project/5903-sonar-for-the-visually-impaired/log/21487-code-name-swiftlet-pcb-fab">limbo</a> somewhere in Vancouver between some dark corners of a warehouse, Canada Post.  There might be also be a case that Canada Post forgot to put on the bar code so it disappeared off their radar.  My other <a href="https://hackaday.io/project/4993-dual-channel-battery-chargeranalyzer/log/21663-where-is-waldo-pcb-status">PCB order</a> that was shipped 2 days earlier has been sitting in Customs limbo since 4th Aug.  There seems to be a common theme here.</p><p>The wait time at Vancouver customs can easily be 3 weeks or <a href="https://cdn.hackaday.io/images/4200561436219234946.png">more</a>.  Even though this package has $12 US value and should be duty free, it still have to wait it out in the bench as the Customs people answered to no one.  See this <a href="http://forums.redflagdeals.com/mail-processing-canada-customs-slow-711375/58/">thread</a> at Red Flag Deals for horror stories of our overly paid civil servants - some waited 6 weeks for that.</p><p><strong>In either case, it is not showing up any time soon.  So I am going to have to make some alternate plans.</strong></p><p>What I am going to do is continue the firmware development on a different platform.  <span class="redactor-invisible-space">I</span>f I plan my code carefully, I can still do some code development.  ChibiOS has hard abstraction layer and basic hardware drivers.  Even then some of the low level stuff are quite different.  The application level code should be the same.</p><ol><li>The closest target: Teensy LC is bricked due to ChibiOS <a href="https://hackaday.io/project/5903-sonar-for-the-visually-impaired/log/21599-hello-hell-desk">bug</a>.</li><li>I managed to get ChibiOS 3.0.0 demo code running on my STM32F103 based <a href="https://hackaday.io/project/6607-stm32f103-canadian-maid-breakout-board">Canadian Maid</a> project.</li><li>I also have a STM32F0 Discovery board.</li><li>I could order a Freescale Freedom FRDM-KL26Z.  This also uses the same MEMS sensor.  Cost $28 + $8 shipping from digikey</li><li>I could order a new batch of PCB and use DHL.  That should take ~ 1 week,  Cost $12 US + $20 US shipping.   Cost some extra coins if I also need another set of board for my other project.</li></ol><p>Options 2-3 are short term solutions as they cost $0 and I can start right now.  I am proceeding with the STM32F103 option. Due to the tight space, I don&apos;t have much luck (yet) with a toner transfer for the MEMS sensor.  Might have to do a dead bug for it at some point if I need it bad enough. Option 4 is the alternative to that.</p><p>By the end of the month, I&apos;ll talk to the supplier again and might be able to get a refund if the PCB is still MIA and no tracking.  There is also a case if my other PCB hasn&apos;t arrive and the supplier is nice enough to get me a refund. I might just combine both design on the same PCB and cut it manually.  I had a lot of issues with DHL and the supplier customs declaration paper works, but at least I know that they&apos;ll get here in about a week and I can sort out a refund later.   I may even try out that new place that spammed me.</p></div>
                            </div>
                        </li>
                    
                </ul>

                
                <div class="pagination">
                    
                    <a href="?page=2" class="grey-gold-button prev-button show">Previous</a>
                    
                    
                </div>
                

                

                </p>

            
        </div>
    </div>

    










<div class="footer" id="footer">
  <a href="#header" class="back-to-top" onClick="CT(this, 'Footer', 'GoingUp');">^ Going up? ^</a>
    <div class="container">
        <p><a href="http://hackaday.com/about/">About Us</a> <a href="mailto:projects-contact@hackaday.com">Contact Us</a> <a href="/project/37">Give Feedback</a>&copy; 2015 Hackaday <a href="/tos">Terms of Use</a> <a href="/privacy-policy">Privacy Policy</a></p>
        <a href="/" class="had-skull"  onClick="CT(this, 'Footer', 'Home' ); return false;">Hackaday.io</a>
    </div>
</div>

<script>

    var csrftoken = 'uVxgDpOs-JWOENpdu0s84z8cjOMsDp0tQTQA';

</script>

    <script type="text/javascript">

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-47229708-1', 'auto');

    var dimensionValue = 'nonregistered';
    ga('set', 'dimension1', dimensionValue);
    ga('require', 'displayfeatures');

    ga('send', 'pageview');

    </script>

<img src="//analytics.supplyframe.com/trackingservlet/impression?action=pageImpression&amp;zone=HIO_logs&amp;extra=logged%3Dfalse%7ChaveAccountCookie%3D0%7C&amp;ab=undefined" class="sf-impression" />

    
    
    <script src="//cdn.hackaday.io/build/h%2FydgsYIeDTf7pqgYQEKK8Ngblw0IkZCDqfJ9S2tk7zsBoxIHt5iOd49Qp%2BF4vdxEuRj%2BGpGDLbX4aGOQGmbjaOxUZvklg4ReFk68R95OQshFrGKebvogKGQOiB5Hi1xym9KC54c9Ps0WpzuNydLk4B%2FbKi91KhV40Uxhl38XXb1IVAxAI8iW%2BoQUPCFkHVWZxD0B%2BMZ%2BuEXJTlWuBmopNMxTHRK5yleITPZODT6evbVRQc6AXs9w2Pfk7FS2nKy-0.48.6.js"></script>

</body>
</html>