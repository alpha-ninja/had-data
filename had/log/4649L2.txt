<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie9" lang="en"> <![endif]-->
<!--[if gt IE 9]><!--> <html class="no-js" lang="en" ng-app="buildlogApp"> <!--<![endif]-->
<head>
    
    <title>Project logs &bull; DIY Electric Vehicle from Recycled Parts &bull; Hackaday.io</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="//cdn.hackaday.io/css/style.css?version=0.48.6" />
    <script type="text/javascript" src="//use.typekit.net/ymb0lgk.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>
<body class="logs">

    <!--
############################################################################################
############################################################################################
############################################################################################
#####################Kt;tL#######################################Kti,E######################
#######################;   .###################################G    E#######################
#######################K    f##################################    ;########################
########################Wj   E###############################K:  .W#########################
##########################.  :E##############################:  .L##########################
#########################D    f##############################.   .##########################
########################,     ;##############################     :E#######K################
################f######K      ,##############################      ,######Lt################
################  W###W       i##############################       t####j t################
################:  E#L.        f###########################L.        f#Ki .E################
################j  ;E.          j##########################.         .G;  i#################
#################L               i#######################K                ##################
#################W                E#####################K;               ;##################
###################:               .###################D               :f###################
#####################DLfGD           G####WEEEEKW####W           ;GffGK#####################
##########################i         iD##Kfi    :jKW##D          iE##########################
###########################W      ,G##f            jE#E;       j############################
############################L     D##D              ,##K       W############################
#############################D:  G#W                  K#E,   G##############################
###############################;i#L                    j## ,E###############################
###############################KK#.                     ##iE################################
#################################j                      ;K##################################
################################W                        ,##################################
################################E                         ##################################
###############################Ki                         D#################################
###############################E.                         L#################################
###############################f    iD##W;       D###D    :#################################
###############################i   i######K     K#####K;   #################################
###############################;  .E#######     #######D   #################################
###############################;  L########     ########   #################################
###############################i  G#######K     K#######   #################################
###############################j  L#####E,       fE#####   #################################
###############################D  .E##j            .t##E  ;#################################
###############################E:  ;##.              #Wt  j#################################
################################G   ;t      tWi      t    E#################################
#############################KL##           K#K;          #K:K##############################
#############################i ##:          ###t         j#f ;K#############################
############################:  G#K          #E#L        L##    D############################
###########################D   ;W#:         #;#L        W#K    .############################
#####################KKEKK      :##L        ; ..      :D##.      fKEEK######################
###################t.            ;##G:               ,##E,             tD###################
##################G               E##E               i##;               :###################
#################D                W##W    iL    E.    ###D                ##################
################W,               G###W    tG    K.    ####:               K#################
################;  LW;         ,E#####:  ;W#    #G   f#####;         ;KG  :K################
################  D###E       ;########WW####WW####WW#######W       :####: j################
################ ,#####:      ;##############################       G####E i################
################K#######.     ;##############################      L######WG################
########################f     i##############################     j#########################
#########################W   .D##############################.   i##########################
#########################E   G###############################D   ,##########################
########################G:   #################################j   G#########################
#######################f    K##################################j    W#######################
#####################Kt :iE#####################################KL:  K######################
############################################################################################
############################################################################################
############################################################################################
-->

<div class="header" id="header">
    <div class="container">
        <h1 class="logo">
            <a href="/" title="Hackaday.io Home" class="home" onclick="CT(this, 'Menu', 'Home'); return false;"></a>
            <a href="/" title="Hackaday.io Home" class="brand" onclick="CT(this, 'Menu', 'Home'); return false;">Hack a Day</a>
        </h1>

        <a href="javascript:void(0);" class="responsive-menu">Menu</a>

        <ul class="nav" role="navigation">
            <li><a href="/projects" class="">Projects</a></li>
            <li><a href="/lists" class="">Lists</a></li>
            <li><a href="/stack" class="">Stack</a></li>
            <li class="dropdown more-nav j-more-open">
                <a href="javascript:void(0)" class="dropdown-link icon-dropdown">More</a>
                <ul role="menu" class="dropdown-menu more-menu" id="j-more">
                    <li><a href="http://hackaday.com/blog/" target="_blank">Blog</a></li>
                    <li><a href="/events">Events</a></li>
                    <li><a href="/hackerspaces">Hackerspaces</a></li>
                    <li><a href="/hackers">Profiles</a></li>
                    <li><a href="/contests">Contests</a></li>
                    <li><a href="/prize" target="_blank">The Hackaday Prize</a></li>
                    <li><a href="/submissions/prize2015/list">2015 Prize Entries</a></li>
                </ul>
            </li>
            <li class="menu-last-child">
                <div class="search-holder show">
                    <form id="search-form" action="/search" onsubmit="return submitSearch();" method="GET">
                        <input type="text" placeholder="Search" name="term" class="input-search j-add-search" id="j-add-search" value="" autocomplete="off" pattern=".{3,}" required title="3 characters minimum" />
                        <input type="submit" class="search-button" />
                    </form>
                </div>
            </li>
        </ul>

        

            <ul class="nav pull-right" role="navigation">
                <li><a href="/signup" class="grey-white-button become-member">Sign up</a></li>
                <li><a href="/signin?returnUrl=%2Fproject%2F4649%2Flogs%3Fpage%3D2">Sign in</a></li>
            </ul>

        
    </div>
</div>

<div id="topMessage" class="alert"><span class="j-top-content"></span><a href="javascript:void(0);" class="alert-close j-top-message-close">Close</a></div>




    <div class="headline">
        <div class="container">
            <h2><a href="/project/4649-diy-electric-vehicle-from-recycled-parts">DIY Electric Vehicle from Recycled Parts</a></h2>
            <p class="description-title"> Project logs</p>
            <p class="description-summary">Converting a car to electric drive using recycled and salvaged EV and hybrid components.</p>
            <div class="description-metainfo">
                
                    <span>created by <a href="/hacker/22542-mauswerkz" title="Visit Profile">mauswerkz</a><span>&bull;</span>
                
                5 months ago<span>&bull;</span><a href="/project/4649#discussion-list" title="See Comments">6 Comments</a></span>
            </div>
        </div>
    </div>

    <div class="container post-content">
        <div class="section-buildsort">
            <span class="pull-left">
                <a href="/project/4649-diy-electric-vehicle-from-recycled-parts">&#171; Back to project details</a>
            </span>
            <span class="sort-holder pull-right">
                <label for="sort-by">Sort by:</label>
                <select class="sort" id="sort-by">
                    <option value="/project/4649/logs/sort/newest">Newest</option>
                    <option value="/project/4649/logs/sort/oldest" selected="selected">Oldest</option>
                </select>
            </span>
        </div>
        <div class="section section-buildlogs last">
            

                <ul class="buillogs-list">
                    
                        <li>
                            <h2><a href="/project/4649/log/20415-locking-the-input-shaft-part-2">Locking the input shaft (Part 2)</a></h2>
                            <small class="authorship">2 months ago  &bull;
                                <a class="gray-link" href="/project/4649/log/20415#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-20415"><p>Input shaft: LOCKED!</p><p><img src="https://cdn.hackaday.io/images/5167681435987017934.jpg"></p><p>I'm now able to lock the two motors together and drive them against each other as a dyno. Did this briefly today and it worked nicely.</p><p>This is an important ability as it lets me tune the offset angle for different speed and torque settings. The IPM motors used in the transmission aren't like simple PMAC or BLDC motors. The IPM motors have a magnetic torque component and a reluctance torque component. This means that I can't just set the current vector to 90 degrees from the rotor magnetic field for maximum torque. I have to set it somewhere in between. I'm not really sure yet whether the optimum angle changes much with speed or torque, but that's what I can find out using this as a dyno.</p><p>The tuning process is this:</p><p style="margin-left: 20px;">1. With one of the motors set to zero torque, set the other motor to a certain speed using a speed control loop (torque-producing current as the output).</p><p style="margin-left: 20px;">2. Set a non-zero current setpoint for the first motor.</p><p style="margin-left: 20px;">3. Sweep the offset angle through the expected range and plot the output of the speed control loop.</p><p style="margin-left: 20px;">4. The angle which requires the highest torque from the speed control loop is the optimum angle for that speed and torque operating point.</p><p style="margin-left: 20px;">5. Repeat that for a handful of strategically selected operating points and plot the relationships.</p><p>I'll start with a constant offset value for the unknown motor while tuning the other one. Once I've done that for both motors, I just have to put them in to a look-up table that is used while driving so I always have the optimum offset angle for every pedal position.</p><p>I'm really looking forward to getting this tuning done so that I can then write the code that implements "throttle" control of the motor torque. This will be fun because it's where I'll set up the framework for tuning the pedal feel. It will also be when I program the gear change required for MG2. That will be an interesting challenge. <br></p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/4649/log/20800-testing-the-dyno-configuration">Testing the dyno configuration</a></h2>
                            <small class="authorship">a month ago  &bull;
                                <a class="gray-link" href="/project/4649/log/20800#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-20800"><p>I ran one test with an arbitrary load setpoint and the speed set to 1400rpm. This was running on only 200v so I was probably right up against field weakening at this point. Below is a quick plot of the results.</p><p><img src="https://cdn.hackaday.io/images/3195341436569618336.JPG"></p>The blue line is the Iq value driven by the speed control loop of the motor acting at the load. As the torque of the driving motor increases, the Iq of the load must increase as well in order to maintain the speed setpoint. <br>The red line is the offset angle of the opposing (driving) motor.<p>Instead of using Iq and Id decoupled, Id always has a setpoint of zero and Iq is the only current setpoint used. The offset angle is the value (4095 = 360 degrees) which the dq axis is offset from being aligned with the motor angle (a-axis).<br></p>For the example plot above, the sweet spot falls at about -50 (only 4 degrees or so). A small number which makes sense for the low speed and low current conditions (&lt;15A).<p>Note that the driving motor was actually set to negative torque (trying to slow the load down). This is why the offset of the driving motor is negative (representing positive Id) and the Iq current of the load is positive (representing positive torque). This condition simulates regenerative braking.<br></p><p>My experiments will extract the offset angle appropriate for a given Iq and speed. This will go in to a 2D look-up table. So all I have to do to control torque is convert the throttle input to an Iq setpoint, then that pull the associated offset angle from the LUT. This eliminates a whole set of trig operations that would need to be done in the microcontroller if I tried to control the angle by breaking it in to an Id vs Iq relationship.<br></p><p>If the relationship ends up being linear (or very close to it), I could just use a simple scaling and offset equation with no divides. Even better than a LUT, but I'm doubtful it'll be that simple.<span></span><br></p>This experiment is intended to get the confidence I need that it's all going to work before committing to tearing in to my car and doing the conversion. It should give me enough to make it driveable and give me most of the performance it'll be capable of. I might fine-tune it on a vehicle dyno someday depending on what operating points I can hit with the transmission alone. I'll be limited to the capability of MG1 which is somewhere around half of MG2. So I won't be able to fully characterize MG2 with this method, but hopefully I can extrapolate based on MG1's results. Time will tell.</div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/4649/log/21997-weights-and-balances">Weights and balances</a></h2>
                            <small class="authorship">18 days ago  &bull;
                                <a class="gray-link" href="/project/4649/log/21997#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-21997"><p>Nothing new to show about the inverter/transmission at the moment. Still working on tuning the control loops and figuring out how to properly generate torque with an IPM. These are tricky beasts, but I&apos;m getting there. I think once I figure out how to handle field weakening (when it should start and how to implement it effectively), I&apos;ll be ready to move to the next step.</p><p>I spent a little bit of time today weighing the major components that I have. I bought a load-cell based crane scale for this task.</p><p>Here&apos;s one of my battery modules being weighed, with its future home watching the process.</p><p><img src="https://cdn.hackaday.io/images/4534381438458525204.jpg"></p><p>The 7kWh module weighs 65.4kg. That&apos;s 9.3kg/kWh. So and entire Volt pack worth of cells weighs ~150kg (330lbs) without the enclosure or front BMS/contactor section. So my 29kWh pack should weigh 270kg (595lbs). Better than I was expecting! </p><p>This, of course, doesn&apos;t include the weight of the battery enclosure/supports I&apos;ll have to build.</p><p>The Lexus transmission weighs 132kg (290lbs). It&apos;s a heavy chunk of metal.</p><p>I&apos;ll be weighing the major components that come out of the car as I remove them (engine, transmission, exhaust). This, combined with the corner weights I got for the car a few weeks back, will allow me to calculate the battery placements/distribution to ensure that I maintain the same front/rear balance. The Volt packs are somewhat reconfigurable, so I&apos;ll be able to fine-tune the weight by moving sub-modules around. The only constraint there is that I&apos;m using the original BMS so need to ensure that that can move with the modules. I don&apos;t want to be running high voltage wires through the car other than the two big ones that go to the inverter.<br></p></div>
                            </div>
                        </li>
                    
                </ul>

                
                <div class="pagination">
                    
                    <a href="?page=1" class="grey-gold-button prev-button show">Previous</a>
                    
                    
                </div>
                

                

                </p>

            
        </div>
    </div>

    










<div class="footer" id="footer">
  <a href="#header" class="back-to-top" onClick="CT(this, 'Footer', 'GoingUp');">^ Going up? ^</a>
    <div class="container">
        <p><a href="http://hackaday.com/about/">About Us</a> <a href="mailto:projects-contact@hackaday.com">Contact Us</a> <a href="/project/37">Give Feedback</a>&copy; 2015 Hackaday <a href="/tos">Terms of Use</a> <a href="/privacy-policy">Privacy Policy</a></p>
        <a href="/" class="had-skull"  onClick="CT(this, 'Footer', 'Home' ); return false;">Hackaday.io</a>
    </div>
</div>

<script>

    var csrftoken = 'ov25Wdia-zTHqMhT0pNVV1Hz0mAkdcSXALug';

</script>

    <script type="text/javascript">

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-47229708-1', 'auto');

    var dimensionValue = 'nonregistered';
    ga('set', 'dimension1', dimensionValue);
    ga('require', 'displayfeatures');

    ga('send', 'pageview');

    </script>

<img src="//analytics.supplyframe.com/trackingservlet/impression?action=pageImpression&amp;zone=HIO_logs&amp;extra=logged%3Dfalse%7ChaveAccountCookie%3D0%7C&amp;ab=undefined" class="sf-impression" />

    
    
    <script src="//cdn.hackaday.io/build/h%2FydgsYIeDTf7pqgYQEKK8Ngblw0IkZCDqfJ9S2tk7zsBoxIHt5iOd49Qp%2BF4vdxEuRj%2BGpGDLbX4aGOQGmbjaOxUZvklg4ReFk68R95OQshFrGKebvogKGQOiB5Hi1xym9KC54c9Ps0WpzuNydLk4B%2FbKi91KhV40Uxhl38XXb1IVAxAI8iW%2BoQUPCFkHVWZxD0B%2BMZ%2BuEXJTlWuBmopNMxTHRK5yleITPZODT6evbVRQc6AXs9w2Pfk7FS2nKy-0.48.6.js"></script>

</body>
</html>