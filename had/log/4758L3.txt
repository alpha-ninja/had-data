<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie9" lang="en"> <![endif]-->
<!--[if gt IE 9]><!--> <html class="no-js" lang="en" ng-app="buildlogApp"> <!--<![endif]-->
<head>
    
    <title>Project logs &bull; SentriFarm &bull; Hackaday.io</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="//cdn.hackaday.io/css/style.css?version=0.48.6" />
    <script type="text/javascript" src="//use.typekit.net/ymb0lgk.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>
<body class="logs">

    <!--
############################################################################################
############################################################################################
############################################################################################
#####################Kt;tL#######################################Kti,E######################
#######################;   .###################################G    E#######################
#######################K    f##################################    ;########################
########################Wj   E###############################K:  .W#########################
##########################.  :E##############################:  .L##########################
#########################D    f##############################.   .##########################
########################,     ;##############################     :E#######K################
################f######K      ,##############################      ,######Lt################
################  W###W       i##############################       t####j t################
################:  E#L.        f###########################L.        f#Ki .E################
################j  ;E.          j##########################.         .G;  i#################
#################L               i#######################K                ##################
#################W                E#####################K;               ;##################
###################:               .###################D               :f###################
#####################DLfGD           G####WEEEEKW####W           ;GffGK#####################
##########################i         iD##Kfi    :jKW##D          iE##########################
###########################W      ,G##f            jE#E;       j############################
############################L     D##D              ,##K       W############################
#############################D:  G#W                  K#E,   G##############################
###############################;i#L                    j## ,E###############################
###############################KK#.                     ##iE################################
#################################j                      ;K##################################
################################W                        ,##################################
################################E                         ##################################
###############################Ki                         D#################################
###############################E.                         L#################################
###############################f    iD##W;       D###D    :#################################
###############################i   i######K     K#####K;   #################################
###############################;  .E#######     #######D   #################################
###############################;  L########     ########   #################################
###############################i  G#######K     K#######   #################################
###############################j  L#####E,       fE#####   #################################
###############################D  .E##j            .t##E  ;#################################
###############################E:  ;##.              #Wt  j#################################
################################G   ;t      tWi      t    E#################################
#############################KL##           K#K;          #K:K##############################
#############################i ##:          ###t         j#f ;K#############################
############################:  G#K          #E#L        L##    D############################
###########################D   ;W#:         #;#L        W#K    .############################
#####################KKEKK      :##L        ; ..      :D##.      fKEEK######################
###################t.            ;##G:               ,##E,             tD###################
##################G               E##E               i##;               :###################
#################D                W##W    iL    E.    ###D                ##################
################W,               G###W    tG    K.    ####:               K#################
################;  LW;         ,E#####:  ;W#    #G   f#####;         ;KG  :K################
################  D###E       ;########WW####WW####WW#######W       :####: j################
################ ,#####:      ;##############################       G####E i################
################K#######.     ;##############################      L######WG################
########################f     i##############################     j#########################
#########################W   .D##############################.   i##########################
#########################E   G###############################D   ,##########################
########################G:   #################################j   G#########################
#######################f    K##################################j    W#######################
#####################Kt :iE#####################################KL:  K######################
############################################################################################
############################################################################################
############################################################################################
-->

<div class="header" id="header">
    <div class="container">
        <h1 class="logo">
            <a href="/" title="Hackaday.io Home" class="home" onclick="CT(this, 'Menu', 'Home'); return false;"></a>
            <a href="/" title="Hackaday.io Home" class="brand" onclick="CT(this, 'Menu', 'Home'); return false;">Hack a Day</a>
        </h1>

        <a href="javascript:void(0);" class="responsive-menu">Menu</a>

        <ul class="nav" role="navigation">
            <li><a href="/projects" class="">Projects</a></li>
            <li><a href="/lists" class="">Lists</a></li>
            <li><a href="/stack" class="">Stack</a></li>
            <li class="dropdown more-nav j-more-open">
                <a href="javascript:void(0)" class="dropdown-link icon-dropdown">More</a>
                <ul role="menu" class="dropdown-menu more-menu" id="j-more">
                    <li><a href="http://hackaday.com/blog/" target="_blank">Blog</a></li>
                    <li><a href="/events">Events</a></li>
                    <li><a href="/hackerspaces">Hackerspaces</a></li>
                    <li><a href="/hackers">Profiles</a></li>
                    <li><a href="/contests">Contests</a></li>
                    <li><a href="/prize" target="_blank">The Hackaday Prize</a></li>
                    <li><a href="/submissions/prize2015/list">2015 Prize Entries</a></li>
                </ul>
            </li>
            <li class="menu-last-child">
                <div class="search-holder show">
                    <form id="search-form" action="/search" onsubmit="return submitSearch();" method="GET">
                        <input type="text" placeholder="Search" name="term" class="input-search j-add-search" id="j-add-search" value="" autocomplete="off" pattern=".{3,}" required title="3 characters minimum" />
                        <input type="submit" class="search-button" />
                    </form>
                </div>
            </li>
        </ul>

        

            <ul class="nav pull-right" role="navigation">
                <li><a href="/signup" class="grey-white-button become-member">Sign up</a></li>
                <li><a href="/signin?returnUrl=%2Fproject%2F4758%2Flogs%3Fpage%3D3">Sign in</a></li>
            </ul>

        
    </div>
</div>

<div id="topMessage" class="alert"><span class="j-top-content"></span><a href="javascript:void(0);" class="alert-close j-top-message-close">Close</a></div>




    <div class="headline">
        <div class="container">
            <h2><a href="/project/4758-sentrifarm">SentriFarm</a></h2>
            <p class="description-title"> Project logs</p>
            <p class="description-summary">Solving a key farming problem: is it safe to harvest / spray / sow today? (+experiments with &#39;big&#39; data in agriculture) </p>
            <div class="description-metainfo">
                
                    <span>created by <a href="/hacker/46379-pastcompute" title="Visit Profile">pastcompute</a><span>&bull;</span>
                
                5 months ago<span>&bull;</span><a href="/project/4758#discussion-list" title="See Comments">13 Comments</a></span>
            </div>
        </div>
    </div>

    <div class="container post-content">
        <div class="section-buildsort">
            <span class="pull-left">
                <a href="/project/4758-sentrifarm">&#171; Back to project details</a>
            </span>
            <span class="sort-holder pull-right">
                <label for="sort-by">Sort by:</label>
                <select class="sort" id="sort-by">
                    <option value="/project/4758/logs/sort/newest">Newest</option>
                    <option value="/project/4758/logs/sort/oldest" selected="selected">Oldest</option>
                </select>
            </span>
        </div>
        <div class="section section-buildlogs last">
            

                <ul class="buillogs-list">
                    
                        <li>
                            <h2><a href="/project/4758/log/16630-experimentalist-musings">Experimentalist musings</a></h2>
                            <small class="authorship">4 months ago  &bull;
                                <a class="gray-link" href="/project/4758/log/16630#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-16630"><p>I figured I'd measure my ESP8266 test system, so I scrounged a 1Ω resistor and estimated the average current at 70mA, i.e. 230mW, even when just sitting on a timer. This is more than the solar panel at peak, and no amount of MPPT will help us with this, so luckily the ESP8266 has a deep sleep mode which various people have estimated  &lt; 50μA, or 165μW.  Downside is until my packages get here I'm stuck with an ESP-01 which will require some precision soldering to enable deep sleep...</p><p>In the meantime I took a closer look at my logs. Occasionally analysis is no match for experimentation but I might as well do some predicting, as well as confirm previous hypotheses.</p><ul><li>There are times the solar panel voltage drops below the regulator input / supercap when the supercap still has a few 100mV of capacity and was below its earlier peak, which means energy is just getting wasted. Effectively at those times the panel is reporting open circuit voltage which is good for a daylight metric but not much else. All the while the capacitor is discharging through the regulator.</li><li>This would be much less of a problem with a AA cell as there is a less direct relationship between voltage and charge.</li><li>I really need to hook up a load and log that for a while, because really all I have proved is I can log some data and that 22F will keep an unloaded 3v3 supply up overnight which isn't that useful by itself</li></ul><p>A combined MPPT / boost circuit would help with the wasted sunlight: varying the switching to track peak power of the panel, efficiently regulating to 2.4V to 95% utilise the capactor, followed by a step up to 3V3... but thats starting to sound a little over complicated.</p><p>Of course, I could revert to a AA rechargable, but that would be less interesting to me at this point. Rechargeables need maintenance: eventually they need replacing and likely to die at an inconvenient time. They also do cost a lot less.</p><p>So back to the back of the very rough envelope: lets assume a rather bad efficiency of 25% and 8 hours daylight, then 2.5V @ 0.02A x 6= 300mWH, and if we use 60s/hour for reading sensors and transmitting and assume 200mA in that small work period then the approximate power required is (.983 * 165μW + .017 * 0.2 * 3.3) x 24 or 273 mWH so we have 10% margin even at those extremes.</p><p>I should have done that calculation more explicitly before, luckily it works out OK. But regardless, to date this has been useful as an exercise for getting my lab back into shape and getting my mind back into the swing of working with electronics.<br></p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/4758/log/16934-various-things">Various things</a></h2>
                            <small class="authorship">4 months ago  &bull;
                                <a class="gray-link" href="/project/4758/log/16934#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-16934"><p>I finally got some time to finish the software and do a v0.1 ground station. Its based around the ESP-01 still because I will need to spend some time working out the circuit board layout for the ESP-07, so at the moment I'm not logging solar voltage, etc. I'm hoping to build it into a suitable box tomorrow and deploy it in the back yard. I've retasked a TPLink router using OpenWRT that is currently receiving logs from the build on my desktop :-) I'd hoped to get there today but I ended up spending some time working around a possible SDK bug in deep sleep mode, which I seem to have resolved successfully.</p><img src="https://cdn.hackaday.io/images/2722771429976528827.png"><p>Along the way I actually came up with some ideas to really squeeze out the ESP-01. Once things are really bedding down I wont need the serial RX pin so that can be retasked; so at that point could put an I2C ADC on the RX and GPIO #2, so things will get interesting for a variety of projects...<br></p><p>More importantly, my inAir9 SX1276  LoRa modules arrived.</p><p>So while the ground sensor is chugging away, I will be working out how to use the modules so that I can then build a proper fencepost relay station.</p><p>I think I may have a use for my Digisparks. I think they have just enough pins and memory that I can use them to make a bridge from my laptop USB to the SX1276 SPI connection so that I can build up some software in Linux and come to a good understanding of their performance in relative comfort.</p><p>The LoRa modules will provide the 10km+ link so they form the critical path at this stage. It will be easy enough to integrate the sensors for rainwater, wind etc later on.</p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/4758/log/16952-5v-3v3-bus-pirate-of-course">5v, 3v3 --&gt; Bus Pirate of course</a></h2>
                            <small class="authorship">4 months ago  &bull;
                                <a class="gray-link" href="/project/4758/log/16952#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-16952"><p>So of course the Digispark needs 5V as I rediscovered when I went to wire it up. I had always run it on USB power until now, and unlike some of my other gadgets it doesn't have a 3v3 converter. Well, it is small. I don't have any spare level converter boards and don't want to wait.</p><p>Then I remembered my Bus Pirate. Problem solved...</p><p><img src="https://cdn.hackaday.io/images/9707051430040122669.jpg"></p><h2>(Update)</h2><p>So the bus pirate is working well. (Apart from only having one...)</p><pre class="hljs nginx">picocom -b 115200 /dev/ttyUSB0

im5 1 1 2 1 2 2
Wva%:6A
[<span class="hljs-link_label">0x42 r:1</span>][<span class="hljs-link_reference">0x01 r:1</span>][<span class="hljs-link_label">0x02 r:1</span>][<span class="hljs-link_reference">0x03 r:1</span>][<span class="hljs-link_label">0x06 r:1</span>][<span class="hljs-link_reference">0x07 r:1</span>]</pre>This produces SPI reads that match the default values in the datasheet. Seeing as this is the first time I ever used SPI , this is a win :-) <pre>/CS ENABLED
WRITE: 0x42 
READ: 0x12 
/CS DISABLED
/CS ENABLED
WRITE: 0x01 
READ: 0x09 
/CS DISABLED
/CS ENABLED
WRITE: 0x02 
READ: 0x1A 
/CS DISABLED
/CS ENABLED
WRITE: 0x03 
READ: 0x0B 
/CS DISABLED
/CS ENABLED
WRITE: 0x06 
READ: 0x6C 
/CS DISABLED
/CS ENABLED
WRITE: 0x07 
READ: 0x80 
/CS DISABLED
</pre>This could get quite involved, so I might set up a separate place to write about it.<br></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/4758/log/16955-could-i-build-an-attiny13-to-spi-bridge">Could I build an ATtiny13 to SPI bridge?</a></h2>
                            <small class="authorship">4 months ago  &bull;
                                <a class="gray-link" href="/project/4758/log/16955#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-16955"><p><em><strong>Concept: Laptop or Android tablet --&gt; USB - Serial adaptor &lt;--&gt; ATtiny13 at 3v3 &lt;--&gt; SX1276?</strong></em></p><p><br>The BusPirate will let me play with the SX1276 registers and do some initial set to work, but even using macros or the built in Basic will get a bit tedious for more serious stuff. The first proper fencepost station will have a 3v3 Carambola2 but its not really useful for portable debugging. When we get to building and tweaking antenna and trying to get range, it will be handiest to be able to hike around with my trusty AspireOne or a tablet...</p><p>At around $1.20 I may as well buy a couple and see if it is possible to cram a very simple serial port register translation and data transfer protocol into 1k of flash!</p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/4758/log/17105-fencepost-home-base-prototype">Fencepost / Home base prototype</a></h2>
                            <small class="authorship">4 months ago  &bull;
                                <a class="gray-link" href="/project/4758/log/17105#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-17105"><p>So, inside the birdsnest are two systems: </p><p>(1) bus pirate and SX1276 inair9 LoRa module</p><p>(2) Carambola2, SX1276 inair9 LoRa module, bmp180 barometer, DS18B20 temperature, RTC, etc.<br></p><img src="https://cdn.hackaday.io/images/7676371430313748296.jpg"><p>I realised that I can write code in binary mode to drive the bus pirate, which means I can write software to run on a laptop to pretend to be the farm base.  Although as a diversion I managed to write code that claims to compile into 1020 bytes for an ATtiny13 to act as a serial - SPI bridge :-) I just need the ATtiny13 to rock up in the mail so I can see if it actually works!</p><p>I also managed  to get SPI over GPIO working on the Carambola2 as the fencepost station, to talk to its SX1276.</p><p>So for a while now there should be more software going on than hardware, although I need to do something about the birdnest so I can put a module out in the paddock. Hmm, a circuit board might help here...<br></p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/4758/log/17525-pcbs-and-circuits">PCBs and Circuits!</a></h2>
                            <small class="authorship">3 months ago  &bull;
                                <a class="gray-link" href="/project/4758/log/17525#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-17525"><p>So we won a OSHPARK voucher. Thank you Hackaday and OSHPARK! I guess there is quite a bit of lead time, so now I put together a circuit for an I/O shield for the Carambola2, most importantly with a breakout for the inAir9 RF module.</p><p><img src="https://cdn.hackaday.io/images/7617891431053752089.PNG"></p><p>I have actually made it quite generic to allow flexibility. It has specific connections for an i2c RTC module and a BMP180 barometer I already have, 1-wire connectors, and expansion for more i2c things and GPIO, and an onboard PCF i2c ADC. Because I might want to swap things around I have made pullups and i2c addressing configurable</p><p>The PCB is still a work in progress, its not finished yet...</p><p><img src="https://cdn.hackaday.io/images/2424091431054006481.PNG"></p>
<p>This will be fine for the farm station, but the other end I am still thinking over the design.</p><p>I really want to have an embedded Linux module in the fence post sensor for power and flexibility, but I think something like, say, a Teensy LC would be useful to slave off all the sensor readings to...</p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/4758/log/17702-your-board-is-awaiting-panelisation">Your board is awaiting panelisation</a></h2>
                            <small class="authorship">3 months ago  &bull;
                                <a class="gray-link" href="/project/4758/log/17702#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-17702"><img src="https://cdn.hackaday.io/images/931721431347858205.png"></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/4758/log/18059-its-alive-muwahaha-or-not">Its Alive! muwahaha (or not...)</a></h2>
                            <small class="authorship">3 months ago  &bull;
                                <a class="gray-link" href="/project/4758/log/18059#discussion-list">
                                    1 comment
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-18059"><p><img src="https://cdn.hackaday.io/images/5121331431860650821.jpg"></p><p>An inAir9 sx1276 module transmitting a beacon (the text "Hello World") using LoRa mode at 918 MHz, 125kHz bandwidth and spreading factor 9. Roughly equivalent to a 4800 baud modem in terms of throughput...</p><p>Driven via a BusPirate in binary SPI mode.</p><p>Next test, using the Carambola2 with OpenWRT and spidev. I have developed the SX1276 code that communicates using an SPI abstract class, with both BusPirate and Linux spidev implementations so that _should_ hopefully be quite straightforward...</p><p>Note also the signal strength in the above picture is exaggerated - when I introduced a short delay between transmissions the colour dropped right off, i.e. stopped saturating the link. Also, I turned down the gain...</p><p>Without even using proper antennas (I hooked up a 2.4G antenna) I was able to see signal on the RTL through 3 stone walls and 50m out to the road, so a good start.</p><p><em>UPDATE</em></p><p>I have the beacon code working on both OpenWRT using spidev, and with the bus pirate now. So on to the receiver...<br></p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/4758/log/18256-physical-design">Physical design</a></h2>
                            <small class="authorship">3 months ago  &bull;
                                <a class="gray-link" href="/project/4758/log/18256#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-18256"><p>We'll need to start on building some actual boxes soon. The fence post is on the critical path, so we'll probably go with some kind of plastic enclosure that we can seal the water out of.</p><p>If we decide to repurpose PVC pipe, or even if not, we will probably need to rig up some parts to hold circuit boards in place. Some 3-d printed components would come in useful there...<br></p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/4758/log/18415-architectural-refinement">Architectural Refinement</a></h2>
                            <small class="authorship">3 months ago  &bull;
                                <a class="gray-link" href="/project/4758/log/18415#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-18415"><p>Now that I have two inAir9 modules talking to each other on my bench, I have been spending some more time considering architectural questions, while waiting for delivery of PCBs.</p><p>At this stage we are looking at using MQTT as the glue.</p><p>The fencepost will be running Linux, and either RSMB or mosquito. There will be a bridge process that is an MQTT client subscribing to wildcard and forwarding the data through the SX1276 to the next hop. By using the right MQTT hierarchy, store and forward should be scalable for the number of hubs we are looking at.  The ground sensors will thus be publishing MQTT clients, and there will also be a publisher inside the fencepost for the weather sensors, etc.  The far end is a second client that receives radio data and publishes the results.</p><p>To reduce bandwidth requirements, I envisage some kind of compression or rather binary translation layer, so that the SX1276 clients will have a small database of MQTT topic to binary code mappings, used to tag each message instead of a full topic.<br></p></div>
                            </div>
                        </li>
                    
                </ul>

                
                <div class="pagination">
                    
                    <a href="?page=2" class="grey-gold-button prev-button ">Previous</a>
                    
                    
                    <a href="?page=4" class="grey-gold-button next-button ">Next</a>
                    
                </div>
                

                

                </p>

            
        </div>
    </div>

    










<div class="footer" id="footer">
  <a href="#header" class="back-to-top" onClick="CT(this, 'Footer', 'GoingUp');">^ Going up? ^</a>
    <div class="container">
        <p><a href="http://hackaday.com/about/">About Us</a> <a href="mailto:projects-contact@hackaday.com">Contact Us</a> <a href="/project/37">Give Feedback</a>&copy; 2015 Hackaday <a href="/tos">Terms of Use</a> <a href="/privacy-policy">Privacy Policy</a></p>
        <a href="/" class="had-skull"  onClick="CT(this, 'Footer', 'Home' ); return false;">Hackaday.io</a>
    </div>
</div>

<script>

    var csrftoken = '5ILYm1SR-KVV4Rq7_8FauR4ePF3EgMUdQqms';

</script>

    <script type="text/javascript">

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-47229708-1', 'auto');

    var dimensionValue = 'nonregistered';
    ga('set', 'dimension1', dimensionValue);
    ga('require', 'displayfeatures');

    ga('send', 'pageview');

    </script>

<img src="//analytics.supplyframe.com/trackingservlet/impression?action=pageImpression&amp;zone=HIO_logs&amp;extra=logged%3Dfalse%7ChaveAccountCookie%3D0%7C&amp;ab=undefined" class="sf-impression" />

    
    
    <script src="//cdn.hackaday.io/build/h%2FydgsYIeDTf7pqgYQEKK8Ngblw0IkZCDqfJ9S2tk7zsBoxIHt5iOd49Qp%2BF4vdxEuRj%2BGpGDLbX4aGOQGmbjaOxUZvklg4ReFk68R95OQshFrGKebvogKGQOiB5Hi1xym9KC54c9Ps0WpzuNydLk4B%2FbKi91KhV40Uxhl38XXb1IVAxAI8iW%2BoQUPCFkHVWZxD0B%2BMZ%2BuEXJTlWuBmopNMxTHRK5yleITPZODT6evbVRQc6AXs9w2Pfk7FS2nKy-0.48.6.js"></script>

</body>
</html>