<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie9" lang="en"> <![endif]-->
<!--[if gt IE 9]><!--> <html class="no-js" lang="en" ng-app="buildlogApp"> <!--<![endif]-->
<head>
    
    <title>Project logs &bull; Open source sport/smart watch &bull; Hackaday.io</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="//cdn.hackaday.io/css/style.css?version=0.48.6" />
    <script type="text/javascript" src="//use.typekit.net/ymb0lgk.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>
<body class="logs">

    <!--
############################################################################################
############################################################################################
############################################################################################
#####################Kt;tL#######################################Kti,E######################
#######################;   .###################################G    E#######################
#######################K    f##################################    ;########################
########################Wj   E###############################K:  .W#########################
##########################.  :E##############################:  .L##########################
#########################D    f##############################.   .##########################
########################,     ;##############################     :E#######K################
################f######K      ,##############################      ,######Lt################
################  W###W       i##############################       t####j t################
################:  E#L.        f###########################L.        f#Ki .E################
################j  ;E.          j##########################.         .G;  i#################
#################L               i#######################K                ##################
#################W                E#####################K;               ;##################
###################:               .###################D               :f###################
#####################DLfGD           G####WEEEEKW####W           ;GffGK#####################
##########################i         iD##Kfi    :jKW##D          iE##########################
###########################W      ,G##f            jE#E;       j############################
############################L     D##D              ,##K       W############################
#############################D:  G#W                  K#E,   G##############################
###############################;i#L                    j## ,E###############################
###############################KK#.                     ##iE################################
#################################j                      ;K##################################
################################W                        ,##################################
################################E                         ##################################
###############################Ki                         D#################################
###############################E.                         L#################################
###############################f    iD##W;       D###D    :#################################
###############################i   i######K     K#####K;   #################################
###############################;  .E#######     #######D   #################################
###############################;  L########     ########   #################################
###############################i  G#######K     K#######   #################################
###############################j  L#####E,       fE#####   #################################
###############################D  .E##j            .t##E  ;#################################
###############################E:  ;##.              #Wt  j#################################
################################G   ;t      tWi      t    E#################################
#############################KL##           K#K;          #K:K##############################
#############################i ##:          ###t         j#f ;K#############################
############################:  G#K          #E#L        L##    D############################
###########################D   ;W#:         #;#L        W#K    .############################
#####################KKEKK      :##L        ; ..      :D##.      fKEEK######################
###################t.            ;##G:               ,##E,             tD###################
##################G               E##E               i##;               :###################
#################D                W##W    iL    E.    ###D                ##################
################W,               G###W    tG    K.    ####:               K#################
################;  LW;         ,E#####:  ;W#    #G   f#####;         ;KG  :K################
################  D###E       ;########WW####WW####WW#######W       :####: j################
################ ,#####:      ;##############################       G####E i################
################K#######.     ;##############################      L######WG################
########################f     i##############################     j#########################
#########################W   .D##############################.   i##########################
#########################E   G###############################D   ,##########################
########################G:   #################################j   G#########################
#######################f    K##################################j    W#######################
#####################Kt :iE#####################################KL:  K######################
############################################################################################
############################################################################################
############################################################################################
-->

<div class="header" id="header">
    <div class="container">
        <h1 class="logo">
            <a href="/" title="Hackaday.io Home" class="home" onclick="CT(this, 'Menu', 'Home'); return false;"></a>
            <a href="/" title="Hackaday.io Home" class="brand" onclick="CT(this, 'Menu', 'Home'); return false;">Hack a Day</a>
        </h1>

        <a href="javascript:void(0);" class="responsive-menu">Menu</a>

        <ul class="nav" role="navigation">
            <li><a href="/projects" class="">Projects</a></li>
            <li><a href="/lists" class="">Lists</a></li>
            <li><a href="/stack" class="">Stack</a></li>
            <li class="dropdown more-nav j-more-open">
                <a href="javascript:void(0)" class="dropdown-link icon-dropdown">More</a>
                <ul role="menu" class="dropdown-menu more-menu" id="j-more">
                    <li><a href="http://hackaday.com/blog/" target="_blank">Blog</a></li>
                    <li><a href="/events">Events</a></li>
                    <li><a href="/hackerspaces">Hackerspaces</a></li>
                    <li><a href="/hackers">Profiles</a></li>
                    <li><a href="/contests">Contests</a></li>
                    <li><a href="/prize" target="_blank">The Hackaday Prize</a></li>
                    <li><a href="/submissions/prize2015/list">2015 Prize Entries</a></li>
                </ul>
            </li>
            <li class="menu-last-child">
                <div class="search-holder show">
                    <form id="search-form" action="/search" onsubmit="return submitSearch();" method="GET">
                        <input type="text" placeholder="Search" name="term" class="input-search j-add-search" id="j-add-search" value="" autocomplete="off" pattern=".{3,}" required title="3 characters minimum" />
                        <input type="submit" class="search-button" />
                    </form>
                </div>
            </li>
        </ul>

        

            <ul class="nav pull-right" role="navigation">
                <li><a href="/signup" class="grey-white-button become-member">Sign up</a></li>
                <li><a href="/signin?returnUrl=%2Fproject%2F4510%2Flogs%3Fpage%3D2">Sign in</a></li>
            </ul>

        
    </div>
</div>

<div id="topMessage" class="alert"><span class="j-top-content"></span><a href="javascript:void(0);" class="alert-close j-top-message-close">Close</a></div>




    <div class="headline">
        <div class="container">
            <h2><a href="/project/4510-open-source-sportsmart-watch">Open source sport/smart watch</a></h2>
            <p class="description-title"> Project logs</p>
            <p class="description-summary">Make Weloop Tommy an open source sport watch that can connect directly to all kind of sensors (heart rate monitor and so on)</p>
            <div class="description-metainfo">
                
                    <span>created by <a href="/hacker/54732-krzysiek" title="Visit Profile">Krzysiek</a><span>&bull;</span>
                
                6 months ago<span>&bull;</span><a href="/project/4510#discussion-list" title="See Comments">50 Comments</a></span>
            </div>
        </div>
    </div>

    <div class="container post-content">
        <div class="section-buildsort">
            <span class="pull-left">
                <a href="/project/4510-open-source-sportsmart-watch">&#171; Back to project details</a>
            </span>
            <span class="sort-holder pull-right">
                <label for="sort-by">Sort by:</label>
                <select class="sort" id="sort-by">
                    <option value="/project/4510/logs/sort/newest">Newest</option>
                    <option value="/project/4510/logs/sort/oldest" selected="selected">Oldest</option>
                </select>
            </span>
        </div>
        <div class="section section-buildlogs last">
            

                <ul class="buillogs-list">
                    
                        <li>
                            <h2><a href="/project/4510/log/16559-softdevicebootloader-installation-internals">Softdevice/bootloader installation internals</a></h2>
                            <small class="authorship">4 months ago  &bull;
                                <a class="gray-link" href="/project/4510/log/16559#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-16559"><p>Finally I have some time to describe how to override bootloader and softdevice. It's not supported by weloop bootloader but nothing stops us from writing a custom firmware that will allow this. To make it as simple as possible and to use existing applications that support nordic DFU I've decided to merge custom installation app with a new bootloader and a softdevice and upload it as a new firmware. After firmware upload installation app is started and bootloader and softdevice are copied to the correct addresses. Unfortunately it's not so easy because it's not possible to override softdevice from the firmware. There's also problem with UICR registers because it's not possible to override them. There's only one way to change UICR - make a full memory erase. But when we do this from a firmware then watch will crash after erase because processor will be executing instructions from empty flash...</p><p>So how I did this? I've created two apps:</p><ul><li>ossw-installer - this app makes a copy of new softdevice and bootloader to an external flash, makes a full memory erase, copies new softdevice and bootloader from external flash to processor flash and sets correct values in UICR.</li><li>ossw-jump - this app copies ossw-installer to processor RAM and jumps to its start address.</li></ul><p>So haw does it work step by step? On the left there's a weloop processor flash structure before any changes. In the middle there's memory structure of ossw-combined.bin file. On the right there's a weloop processor flash structure after installation of ossw-combined.hex using <a href="https://play.google.com/store/apps/details?id=no.nordicsemi.android.mcp&amp;hl=en" target="_blank">nRF Master Control Panel</a>.<br></p><p><img src="https://cdn.hackaday.io/images/733621429125862074.png"></p><p>After firmware installation weloop restarts and bootloader is executed and passes execution to ossw-jump. This app copies ossw-installer to RAM. <br></p><p><img src="https://cdn.hackaday.io/images/9911591429126021383.png"></p>Then ossw-jump jumps to ossw-installer start address. This app copies new bootloader and softdevice to external flash.<p><img src="https://cdn.hackaday.io/images/8946211429126223509.png"></p><p>After copying bootloader and softdevice full memory flash erase is executed so weloop processor flash is empty.<br></p><p><img src="https://cdn.hackaday.io/images/3747541429126500612.png">And finally new bootloader and softdevice is copied from external flash to processor flash and new bottloader address (0x3C000) is set in UICR.</p><p><img src="https://cdn.hackaday.io/images/5206341429126599904.png">And that's it, we have a new bootloader and S120 2.0.0 softdevice and may upload a new firmware with <a href="https://play.google.com/store/apps/details?id=no.nordicsemi.android.nrftoolbox&amp;hl=en" target="_blank">nRF Toolbox</a>.</p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/4510/log/16758-quick-update">Quick update</a></h2>
                            <small class="authorship">4 months ago  &bull;
                                <a class="gray-link" href="/project/4510/log/16758#discussion-list">
                                    5 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-16758"><p>I've just recorded watch upgrade process and will publish it in a few days. It's stable, I've added visual notification to be able to verify if everything was upgraded successfully. </p><p><a href="https://github.com/ossw/ossw-installer/releases">HERE</a> you can find a newest softdevice/bootloader installer. After flashing this firmware watch will restart and use the newest S120 2.0.0 softdevice. After that you can upload your custom firmware that can work as a peripheral or as a central device. I've also created a mock application to start writing firmware, source code for it can be found <a href="https://github.com/ossw/ossw-firmware-s120" target="_blank">HERE</a>.<br><br></p><p>DFU (bootloader) looks like this:</p><p><img src="https://cdn.hackaday.io/images/9591801429568688451.jpg"></p><p>Test app:</p><p><img src="https://cdn.hackaday.io/images/1495421429568536567.jpg"></p><p>And without backlight:<br></p><p><img src="https://cdn.hackaday.io/images/645361429568243757.jpg"></p><p>From now on I will focus on firmware functionality. Stay tuned!</p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/4510/log/17815-whats-next">What&#39;s next?</a></h2>
                            <small class="authorship">3 months ago  &bull;
                                <a class="gray-link" href="/project/4510/log/17815#discussion-list">
                                    2 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-17815"><p>Hi, I'm back and here are the things I will focus on in the next days/weeks:</p><ul><li>add font support + possibility to upload fonts for given locale</li><li>write android app that sends notifications to the watch</li><li>add a service to android app that will allow to register data sources from other android apps like current weather, data from external sensors etc.</li><li>embed <a href="http://www.compuphase.com/pawn/pawn.htm" target="_blank">PAWN</a> abstract machine to allow writing custom apps for the watch, those compiled scripts will be saved on external flash so there will be additional 512kB for the apps. </li></ul></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/4510/log/18892-still-alive">Still alive</a></h2>
                            <small class="authorship">3 months ago  &bull;
                                <a class="gray-link" href="/project/4510/log/18892#discussion-list">
                                    25 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-18892"><p>Just quick update what I've managed to do:</p><ul><li>it's possible to choose between central (without phone) and peripheral (with phone) mode on watch start</li><li>I've written simple android app that sends sensor data from IpSensorMan to a watch in peripheral mode. Currently it's only HR and CSC but it's extremely easy to add any other sensor type that IpSensorMan supports. IpSensorMan supports both ANT and BLE devices (to use BLE devices you need to install <a href="http://www.iforpowell.com/cms/index.php?page=btle-beta" target="_blank">beta</a> version of this app)</li><li>In central mode watch can connect directly to HR sensor. Other sensors will be added but it requires a little bit more work then adding them in peripheral mode.</li><li>I rewrote gui so it's now more generic and allow to use controls on a screen. Still it requires a bit of work to be able to define what should be displayed on a watch from the phone screen (like cycling speed in this place and this size, heart rate there etc.)</li><li>Handling notifications like missed phone calls and sms is still TODO</li><li>I've managed to create a firmware that reverts watch to original softdevice/bootloader so it will be possible to go back to original firmware if you don't like mine ;)</li><li>I've embedded PAWN abstract machine so it's possible to run scripts on a watch but only from internal flash/ram, have to rewrite it to be able to read them from external flash.</li></ul><p>All of this is still an alpha version so I have to put some more work to make it user friendly and generic. Expect some photos/videos how this works in the next week.<br><br></p></div>
                            </div>
                        </li>
                    
                </ul>

                
                <div class="pagination">
                    
                    <a href="?page=1" class="grey-gold-button prev-button show">Previous</a>
                    
                    
                </div>
                

                

                </p>

            
        </div>
    </div>

    










<div class="footer" id="footer">
  <a href="#header" class="back-to-top" onClick="CT(this, 'Footer', 'GoingUp');">^ Going up? ^</a>
    <div class="container">
        <p><a href="http://hackaday.com/about/">About Us</a> <a href="mailto:projects-contact@hackaday.com">Contact Us</a> <a href="/project/37">Give Feedback</a>&copy; 2015 Hackaday <a href="/tos">Terms of Use</a> <a href="/privacy-policy">Privacy Policy</a></p>
        <a href="/" class="had-skull"  onClick="CT(this, 'Footer', 'Home' ); return false;">Hackaday.io</a>
    </div>
</div>

<script>

    var csrftoken = 'AmIPpPG8-WTKM-bhAN2niyGE56uGpCsS4ebo';

</script>

    <script type="text/javascript">

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-47229708-1', 'auto');

    var dimensionValue = 'nonregistered';
    ga('set', 'dimension1', dimensionValue);
    ga('require', 'displayfeatures');

    ga('send', 'pageview');

    </script>

<img src="//analytics.supplyframe.com/trackingservlet/impression?action=pageImpression&amp;zone=HIO_logs&amp;extra=logged%3Dfalse%7ChaveAccountCookie%3D0%7C&amp;ab=undefined" class="sf-impression" />

    
    
    <script src="//cdn.hackaday.io/build/h%2FydgsYIeDTf7pqgYQEKK8Ngblw0IkZCDqfJ9S2tk7zsBoxIHt5iOd49Qp%2BF4vdxEuRj%2BGpGDLbX4aGOQGmbjaOxUZvklg4ReFk68R95OQshFrGKebvogKGQOiB5Hi1xym9KC54c9Ps0WpzuNydLk4B%2FbKi91KhV40Uxhl38XXb1IVAxAI8iW%2BoQUPCFkHVWZxD0B%2BMZ%2BuEXJTlWuBmopNMxTHRK5yleITPZODT6evbVRQc6AXs9w2Pfk7FS2nKy-0.48.6.js"></script>

</body>
</html>