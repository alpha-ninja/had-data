<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie9" lang="en"> <![endif]-->
<!--[if gt IE 9]><!--> <html class="no-js" lang="en" ng-app="buildlogApp"> <!--<![endif]-->
<head>
    
    <title>Project logs &bull; $1/W True MPPT &bull; Hackaday.io</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="//cdn.hackaday.io/css/style.css?version=0.48.6" />
    <script type="text/javascript" src="//use.typekit.net/ymb0lgk.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>
<body class="logs">

    <!--
############################################################################################
############################################################################################
############################################################################################
#####################Kt;tL#######################################Kti,E######################
#######################;   .###################################G    E#######################
#######################K    f##################################    ;########################
########################Wj   E###############################K:  .W#########################
##########################.  :E##############################:  .L##########################
#########################D    f##############################.   .##########################
########################,     ;##############################     :E#######K################
################f######K      ,##############################      ,######Lt################
################  W###W       i##############################       t####j t################
################:  E#L.        f###########################L.        f#Ki .E################
################j  ;E.          j##########################.         .G;  i#################
#################L               i#######################K                ##################
#################W                E#####################K;               ;##################
###################:               .###################D               :f###################
#####################DLfGD           G####WEEEEKW####W           ;GffGK#####################
##########################i         iD##Kfi    :jKW##D          iE##########################
###########################W      ,G##f            jE#E;       j############################
############################L     D##D              ,##K       W############################
#############################D:  G#W                  K#E,   G##############################
###############################;i#L                    j## ,E###############################
###############################KK#.                     ##iE################################
#################################j                      ;K##################################
################################W                        ,##################################
################################E                         ##################################
###############################Ki                         D#################################
###############################E.                         L#################################
###############################f    iD##W;       D###D    :#################################
###############################i   i######K     K#####K;   #################################
###############################;  .E#######     #######D   #################################
###############################;  L########     ########   #################################
###############################i  G#######K     K#######   #################################
###############################j  L#####E,       fE#####   #################################
###############################D  .E##j            .t##E  ;#################################
###############################E:  ;##.              #Wt  j#################################
################################G   ;t      tWi      t    E#################################
#############################KL##           K#K;          #K:K##############################
#############################i ##:          ###t         j#f ;K#############################
############################:  G#K          #E#L        L##    D############################
###########################D   ;W#:         #;#L        W#K    .############################
#####################KKEKK      :##L        ; ..      :D##.      fKEEK######################
###################t.            ;##G:               ,##E,             tD###################
##################G               E##E               i##;               :###################
#################D                W##W    iL    E.    ###D                ##################
################W,               G###W    tG    K.    ####:               K#################
################;  LW;         ,E#####:  ;W#    #G   f#####;         ;KG  :K################
################  D###E       ;########WW####WW####WW#######W       :####: j################
################ ,#####:      ;##############################       G####E i################
################K#######.     ;##############################      L######WG################
########################f     i##############################     j#########################
#########################W   .D##############################.   i##########################
#########################E   G###############################D   ,##########################
########################G:   #################################j   G#########################
#######################f    K##################################j    W#######################
#####################Kt :iE#####################################KL:  K######################
############################################################################################
############################################################################################
############################################################################################
-->

<div class="header" id="header">
    <div class="container">
        <h1 class="logo">
            <a href="/" title="Hackaday.io Home" class="home" onclick="CT(this, 'Menu', 'Home'); return false;"></a>
            <a href="/" title="Hackaday.io Home" class="brand" onclick="CT(this, 'Menu', 'Home'); return false;">Hack a Day</a>
        </h1>

        <a href="javascript:void(0);" class="responsive-menu">Menu</a>

        <ul class="nav" role="navigation">
            <li><a href="/projects" class="">Projects</a></li>
            <li><a href="/lists" class="">Lists</a></li>
            <li><a href="/stack" class="">Stack</a></li>
            <li class="dropdown more-nav j-more-open">
                <a href="javascript:void(0)" class="dropdown-link icon-dropdown">More</a>
                <ul role="menu" class="dropdown-menu more-menu" id="j-more">
                    <li><a href="http://hackaday.com/blog/" target="_blank">Blog</a></li>
                    <li><a href="/events">Events</a></li>
                    <li><a href="/hackerspaces">Hackerspaces</a></li>
                    <li><a href="/hackers">Profiles</a></li>
                    <li><a href="/contests">Contests</a></li>
                    <li><a href="/prize" target="_blank">The Hackaday Prize</a></li>
                    <li><a href="/submissions/prize2015/list">2015 Prize Entries</a></li>
                </ul>
            </li>
            <li class="menu-last-child">
                <div class="search-holder show">
                    <form id="search-form" action="/search" onsubmit="return submitSearch();" method="GET">
                        <input type="text" placeholder="Search" name="term" class="input-search j-add-search" id="j-add-search" value="" autocomplete="off" pattern=".{3,}" required title="3 characters minimum" />
                        <input type="submit" class="search-button" />
                    </form>
                </div>
            </li>
        </ul>

        

            <ul class="nav pull-right" role="navigation">
                <li><a href="/signup" class="grey-white-button become-member">Sign up</a></li>
                <li><a href="/signin?returnUrl=%2Fproject%2F6273%2Flogs">Sign in</a></li>
            </ul>

        
    </div>
</div>

<div id="topMessage" class="alert"><span class="j-top-content"></span><a href="javascript:void(0);" class="alert-close j-top-message-close">Close</a></div>




    <div class="headline">
        <div class="container">
            <h2><a href="/project/6273-1w-true-mppt">$1/W True MPPT</a></h2>
            <p class="description-title"> Project logs</p>
            <p class="description-summary">Build a $1 per Watt parallelizable MPPT controller, without cutting corners.</p>
            <div class="description-metainfo">
                
                    <span>created by <a href="/hacker/74371-jonathan-bruneau" title="Visit Profile">Jonathan Bruneau</a><span>&bull;</span>
                
                2 months ago<span>&bull;</span><a href="/project/6273#discussion-list" title="See Comments">8 Comments</a></span>
            </div>
        </div>
    </div>

    <div class="container post-content">
        <div class="section-buildsort">
            <span class="pull-left">
                <a href="/project/6273-1w-true-mppt">&#171; Back to project details</a>
            </span>
            <span class="sort-holder pull-right">
                <label for="sort-by">Sort by:</label>
                <select class="sort" id="sort-by">
                    <option value="/project/6273/logs/sort/newest">Newest</option>
                    <option value="/project/6273/logs/sort/oldest" selected="selected">Oldest</option>
                </select>
            </span>
        </div>
        <div class="section section-buildlogs last">
            

                <ul class="buillogs-list">
                    
                        <li>
                            <h2><a href="/project/6273/log/19592-changing-the-architecture">Changing the Architecture</a></h2>
                            <small class="authorship">2 months ago  &bull;
                                <a class="gray-link" href="/project/6273/log/19592#discussion-list">
                                    0 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-19592"><p>I was looking over the schematics recently looking for ways to reduce cost, and it occurred to me that the current topology isn't ideal.  </p><p>Currently, I'm implementing a buck regulator using the <a href="http://www.microchip.com/wwwproducts/Devices.aspx?dDocName=en544838">PIC16F1823</a>.  The MCU is driving the <a href="http://www.irf.com/product-info/datasheets/data/ir2302.pdf">IR2302</a> bridge controller, which in turn runs a pair of NFETs (one for the high side, one for the low side).  I did this initially since I had envisioned the MPPT controller operating at high voltage, but realistically except for a few exotic panels the highest voltage solar panel I can seem to find are 24V (I do own two 50V panels, but those are rarities to say the least).  </p><p>These's also a catch with using the IR2302.  The VCC voltage for the part is 5-15V, and in order to save on cost, I have a 5V LDO powering the entire board (MCU and IRF2302).  While this works well it does prevent the controller from operating with the large number of solar panels who's maximum power point voltage is lower than 5V.  I've thought of keeping the IR2302, use a 3.3V LDO (to lower the controller's minimum operating voltage) and add a voltage doubler charge pump to power the IR2302, but that setup add unnecessary cost since...</p><p>...I'm realistically dealing with solar panels that won't have a open circuit voltage higher than 15-16V-ish, I can completely dispense of the IR2302 and replace the NFET pair with a PFET-NFET pair.  As long as I have the proper protection to keep the VGS voltage in spec, I should be in good shape.  To cut cost, I could remove the protection and get a PFET with a sufficiently high max VGS voltage to cover the range of interest (max VGS of 20V would work well).</p><p>Removing the IR2302 also allows me to lower the minimum voltage down to something pretty great: hopefully down to 1.8V with a single LDO.  And with the 100% duty cycle the PFET-NFET pair affords me, I could realistically run the MPPT controller to a voltage pretty close to the 1.8V mark.  This gives me a range of 1.8V-20V-ish, which is considerably more suitable.</p><p>I did a preliminary search and the <a href="http://www.irf.com/product-info/datasheets/data/irf7507pbf.pdf">IRF7507</a> seems to be like the right PFET-NFET pair (and at $0.76, it's nothing to scoff at), although I'd be open to suggestions.</p><p>This brings me to the next crutch in this design.  If I'm operating at 1.8V, I think I'll need to change microcontrollers.  Yes, the <a href="http://www.microchip.com/wwwproducts/Devices.aspx?dDocName=en544838">PIC16LF1823</a> does work at 1.8V, but it can't be programmed with a VDD voltage lower than 2.7V, which complicates the circuit and adds cost.  I've been eyeing the <a href="http://www.microchip.com/wwwproducts/Devices.aspx?product=PIC16F1705">PIC16LF1705</a> (can trigger the ADC off a timer), but the same problem exists.  I might end up choosing the <a href="http://www.atmel.com/devices/ATSAMD10C13A.aspx"></a><a href="http://www.atmel.com/devices/ATSAMD10C13A.aspx">ATSAMD10C13A</a>, which has similar functionality (namely PWM circuitry with dead-time insertion and halt on comparator trip).  It's a little more expensive, but it operates down to 1.62V and has a single cycle multiply instruction, helpful for running the PI control loop.  I'm still on the fence regarding MCU selection.  I'd really like to stick with something that's cost sensitive.</p><p>Lastly, to cut cost, the current MPPT controller has no current sense.  The maximum power point is achieved by measuring the solar panel's open voltage and ramping up the PWM duty cycle until the panel's voltage reaches 80% of the no-load voltage.  While this works well, the circuit has no over-current protection (OCP), which makes me nervous.  The current implementation has a fuse in line with the inductor to address over current conditions, but it's not a proper long term solution.  Realistically, the MPPT controller should protect itself.</p><p>And so I'm on the lookout for a high-side current sensor that doesn't break the bank.  Ideally I would want a current sensor on the high-side and low-side of the buck regulator, but since I'm trying to save on cost, and current sensors are expensive, I'd rather go with a high-side and add the measured current data to the MPPT algorithm.  This would allow me to find the true maximum power point, as opposed to the current solution (which is a mere approximation).  I'm eyeing the <a href="http://www.silabs.com/Support%20Documents/TechnicalDocs/TSM9634F.pdf">TSM9634</a><a href="http://www.silabs.com/Support%20Documents/TechnicalDocs/TSM9634F.pdf"> </a>at the moment, but am open to suggestions.</p><p>Anyways, this is what's going through my head.  More to come.<br><br></p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/6273/log/20457-current-sensor-musing">Current Sensor Musing</a></h2>
                            <small class="authorship">a month ago  &bull;
                                <a class="gray-link" href="/project/6273/log/20457#discussion-list">
                                    2 comments
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-20457"><p>Lately I've been looking for the right current sensor, or said differently, the best bang for the buck, while staying in budget.  Taking into account the other components on the PCB, I figure I have around $1 to budget.  I also prefer high side current sensors as they eliminate the possibility of accidentally tying the PVs GND to the output's GND, which would bypass a low-side current sensor.</p><p>High-side current sensors come in two flavors: those with an external VDD pin, and those who use the sensor input (common-mode voltage) to power the IC.  The latter tend to be less costly but require a minimum common-mode voltage in order to properly operate.  This means that said current sensor could not be tied to the output of the buck regulator since at lower voltages the sensor would not work (imagine charging a supercap at 0V).  These sensors would need to be tied to the solar input.  The two common-mode current sensors I'm currently eyeing are the <a href="http://www.silabs.com/Support%20Documents/TechnicalDocs/TSM9938F.pdf">TSM9938</a> and the <a href="http://www.silabs.com/Support%20Documents/TechnicalDocs/TS1103.pdf">TS1103</a>.</p><p>On the pricier end, the <a href="http://www.maximintegrated.com/en/products/analog/amplifiers/MAX44284.html">MAX4428</a> is powered using a dedicated VDD pin.  This sensor gives much better results and could be placed on the output of the regulator, but again, it cost more.</p><p>And so I'm in a pickle.  I could either place a single high-side current sensor on the input or at the output, but not both, as I go over budget.  </p><p>Having the current sensor on the input has certain advantages: I can easily track the actual MPP as I would have both the input voltage and current for the PV proper.  However, this configuration prevents me from measuring the current on the output.  I could play a game where I calculate the output current in function of the output voltage and assume that the power supply is 100% efficient (to be conservative), but doing so is unreliable (actual output current reading is still unknown) and the over current protection may be too slow to respond (could only respond as fast as I could run the control loop).  </p><p>Conversely, having the current sensor on the buck regulator's output gives me an accurate over current protection but an inaccurate actual PV current.  I could get away with estimating the PV's current assuming 100% efficiency, but this is not ideal for the same reasons listen above.</p><p>Maybe I'm causing myself entirely too many headaches.  Maybe the real answer is placing a low-side current sensor (cheap) and somehow emphasize that the PV's GND should not be tied to the output's GND.</p><p>As usual, I welcome suggestions.<br></p></div>
                            </div>
                        </li>
                    
                        <li>
                            <h2><a href="/project/6273/log/22154-two-options">Two Options</a></h2>
                            <small class="authorship">13 days ago  &bull;
                                <a class="gray-link" href="/project/6273/log/22154#discussion-list">
                                    1 comment
                                </a>
                                </small>
                            <div style="position:relative">
                                <div id="post-body-22154"><p>Over the last few weeks I&apos;ve been searching the web trying to find the right balance of parts and cost in order to meet or exceed the $1/W budget.  I&apos;ve compiled a long list of possible configurations in an Excel sheet (see sample below) and have narrowed it down to two options.</p><p><img src="https://cdn.hackaday.io/images/3360691438748217268.png"></p><p>But first, allow me to tie up some loose ends.</p><p>Originally I had thought that driving a P-Channel MOSFET (PMOS) on the high side would help reduce on cost.  While this is true, the cost difference between using a PMOS vs. an NMOS is only about $0.06/W.  That is to say, having a half-bridge driver + NMOS is just slightly more expensive than using a PMOS with respective circuitry to drive it.  This is true because driving a PMOS isn&apos;t as simple as doing something like this:</p><p><img src="http://www.maximintegrated.com/en/images/appnotes/1158/1158Fig03.gif"></p><p>Image taken from <a href="http://pdfserv.maximintegrated.com/en/an/AN1158.pdf">Maxim&apos;s App Note 1158</a>.</p><p>The reason this doesn&apos;t work is because the PMOS&apos; gate has some capacitance associated with it, and so when the lower NMOS turns off, an RC circuit is formed between the pull-up resistor and the PMOS gate capacitance.  In effect, this causes the PMOS to turn off slowly for large resistances and/or gate capacitances.  Below is a capture I did of a PMOS of interest driven in this manner:</p><p><img style="width: 553px; height: 332px;" src="https://cdn.hackaday.io/images/3504221438748812900.png" height="332" width="553"></p><p>The yellow line is the NMOS gate input, and the blue (cyan?) line is the PMOS&apos; gate.  That long rise time on the blue line is the problem.  The PMOS quickly turns on, but turns off rather slowly, which causes shoot through problem in synchronously rectified buck regulators, in turn affecting the regulator&apos;s efficiency.</p><p>I was able to get the PMOS to turn off quickly, but the resistor value needed to accomplish this was unacceptably large, thus voiding this simple circuit for  synchronous buck regulator.</p><p>Of course, it is possible to drive a PMOS quickly using a more involved circuit, but for the same price I can get an integrated NMOS half-bridge driver.  The one I&apos;m currently eyeing is the <a href="http://www.onsemi.com/PowerSolutions/product.do?id=NCP3420">NCP3420</a>, and at $0.24/1000 parts, that&apos;s nothing to scoff at.  Pair that with two <a href="http://www.diodes.com/datasheets/ds31787.pdf">DMN3404L-7</a> NMOS, and we&apos;re looking at a total BOM of $1.64 (includes microcontroller, current sensor, passives, etc.).  </p><p>The half-bridge  driver runs on 5V, so if we want our MPPT regulator to support 5V solar panels, then we need to add a charge pump to bring-up the voltage to 5V when the solar panel&apos;s voltage is lower.  The cheapest reasonable regulator I could find was the <a href="http://www.maximintegrated.com/en/products/power/charge-pumps/MAX1720.html">MAX1720</a>, bringing the new total to $1.88.</p><p>This is pretty good, and I&apos;m currently layout out the board for this option.</p><p>There is, however, a possible second option.  <a href="https://hackaday.io/MrJBSwe">mr.jb.swe</a> suggested using a buck regulator IC and tying the enable pin to a PWM coming from a microcontroller (MCU).  In other words, instead of having a MCU drive a MOSFET driver IC, the MCU would drive the enable pin of a &quot;all in one&quot; ready made buck regulator.  There are several advantages to using this method.</p><ol><li>It&apos;s considerably cheaper.  For instance, using the <a href="http://www.richtek.com/Products/Switching%20Regulators/DC_DC%20StepDown%20Convertor/RT8299">RT8299</a> runs me at $0.33/1000 parts and would bring the BOM down to $1.53, or a savings of $0.35.</li><li>It includes the half-bridge driver, the bootstrap diode for the driver, the NMOS fets, and a high-side current sensor with over-current protection.</li><li>Being integrated, using this part would make the PCB smaller, which lowers PCB costs.</li><li>Since all the work is done by the external buck regulator, the requirements for the MCU running the MPPT algorithm is substantially lowered.  All the MCU needs to do is read an ADC channel and generated a PWM output.  No comparators nor fancy PWM are needed, and the MCU can be clocked at a much lower frequency.</li><li>The integrated regulator has over-temperature limits included, which eliminates the need for the MCU to do this work.</li></ol><p>The one catch to this option is that there are start-up costs associated with each off/on cycle of the enable pin on the external buck regulator.  That being said, I *HAVE* to try this option, as it is by far the most cost effective solution and I&apos;d be crazy not to give this a whirl.  Who knows: perhaps the savings will outweigh the start-up cost.</p><p>More to come.<br></p></div>
                            </div>
                        </li>
                    
                </ul>

                

                

                </p>

            
        </div>
    </div>

    










<div class="footer" id="footer">
  <a href="#header" class="back-to-top" onClick="CT(this, 'Footer', 'GoingUp');">^ Going up? ^</a>
    <div class="container">
        <p><a href="http://hackaday.com/about/">About Us</a> <a href="mailto:projects-contact@hackaday.com">Contact Us</a> <a href="/project/37">Give Feedback</a>&copy; 2015 Hackaday <a href="/tos">Terms of Use</a> <a href="/privacy-policy">Privacy Policy</a></p>
        <a href="/" class="had-skull"  onClick="CT(this, 'Footer', 'Home' ); return false;">Hackaday.io</a>
    </div>
</div>

<script>

    var csrftoken = 'u5HgHzkv-8UpT-FapFcbhLSfnowRGibYMCqg';

</script>

    <script type="text/javascript">

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-47229708-1', 'auto');

    var dimensionValue = 'nonregistered';
    ga('set', 'dimension1', dimensionValue);
    ga('require', 'displayfeatures');

    ga('send', 'pageview');

    </script>

<img src="//analytics.supplyframe.com/trackingservlet/impression?action=pageImpression&amp;zone=HIO_logs&amp;extra=logged%3Dfalse%7ChaveAccountCookie%3D0%7C&amp;ab=undefined" class="sf-impression" />

    
    
    <script src="//cdn.hackaday.io/build/h%2FydgsYIeDTf7pqgYQEKK8Ngblw0IkZCDqfJ9S2tk7zsBoxIHt5iOd49Qp%2BF4vdxEuRj%2BGpGDLbX4aGOQGmbjaOxUZvklg4ReFk68R95OQshFrGKebvogKGQOiB5Hi1xym9KC54c9Ps0WpzuNydLk4B%2FbKi91KhV40Uxhl38XXb1IVAxAI8iW%2BoQUPCFkHVWZxD0B%2BMZ%2BuEXJTlWuBmopNMxTHRK5yleITPZODT6evbVRQc6AXs9w2Pfk7FS2nKy-0.48.6.js"></script>

</body>
</html>